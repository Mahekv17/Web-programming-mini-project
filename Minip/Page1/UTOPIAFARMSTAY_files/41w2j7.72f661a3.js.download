(this.$WP=this.$WP||[]).push(["41w2j7",(e,i)=>{var t,n,s,o,r,d,a,_,l=()=>window.JS_SECURITY_TOKEN,c=()=>({"content-type":"application/json","x-requested-by":l()}),p=(e,i,t)=>{fetch("/data/1.0/tap/recordEvent",{method:"POST",headers:c(),credentials:"same-origin",body:JSON.stringify({eventType:t,requestGuid:e,externalId:i})}).then(e=>(e.ok||console.error(`Did not get an ok. got: ${e.statusText}`),e)).catch(e=>{console.error(`Error sending TripAds click event: ${e.message}`)})},g=(e,i)=>{p(e,i,"CLICKED")},u=(e,i)=>{p(e,i,"CLICKED_UNPAID")},m=(e,i)=>{p(e,i,"IMPRESSED")},k=(e,i,t,n,s)=>{var{sponsoredListing:r}=e,d={};r&&(d={placement_slot_name:r.placement_slot_name,location_id:e.id,sponsored_type:r.sponsored_type,opportunity_uid:r.opportunity_uid,sl_line_item_id:r.sl_line_item_id,page_geo_id:i,chosen_location_id:e.id,listing_key:e.listingKey,trip_ads_select_guid:r.trip_ads_select_request_guid,trip_ads_id:r.trip_ads_id}),o(t,n,{...d,...s})},v=(e,i)=>{k(e,i,"impression","paid_backup_sponsored_listing_displayed",{})},f=(e,i)=>{var{sponsoredListing:t}=e;t&&k(e,i,"action","paid_backup_sponsored_listing_click",{ik:t.impression_key,tt_placement:t.tt_placement})},y=(e,i,t)=>{var n=i.isInstantBook?"paid_backup_sponsored_ib_click":"paid_backup_sponsored_meta_click";"undefined"!=typeof window&&window.require&&window.require(["trjs!commerce/offerclick"],s=>{var{url:o,...r}=s.expandToken(i.offerClickToken);k(e,t,"action",n,r)})},E=(e,{auth:i,meta:t},n)=>{var{sponsoredListing:o}=e;o&&s(n,{is_member:i.isMember,device_type:t.device.userAgentCategory?t.device.userAgentCategory.toLowerCase():"",locationId:e.id,slot:o.placement_slot_name,trip_ads_select_guid:o.trip_ads_select_request_guid,listing_key:e.listingKey})},h=e=>{var i=new Date;i.setTime(i.getTime()+1e4);var n={expires:i};t.set("sponsOppId",e.opportunity_uid,n),t.set("sponsLineItem",e.sl_line_item_id,n)},T=(e,i)=>{e.trip_ads_select_request_guid&&i(e.trip_ads_select_request_guid,e.opportunity_uid||"")},b="SP_PARTNER_NOTIFICATION_IFRAME",w=e=>{if(e){var i=document.getElementById(b);i||((i=document.createElement("iframe")).setAttribute("id",b),i.setAttribute("style","position: absolute; visibility: hidden; right: 0; bottom: 0; width: 1px; height: 1px"),d(a.ALL,()=>{document.body&&i&&document.body.appendChild(i)})),i.src=e}},C=()=>window.JS_SECURITY_TOKEN,S=()=>({"content-type":"application/json","x-requested-by":C()}),I=(e,i)=>{if("undefined"!=typeof window&&window.require){var{slot:t}=window.require("trjs!commerce/offerclick").expandToken(i.offerClickToken);return!!e&&"DISCOVERY_META_PREFERENCE"===e.sponsored_type&&"1"===t}return!1},L=e=>{if("undefined"!=typeof window&&window.require){var{ttAOK:i}=window.require("trjs!commerce/offerclick").expandToken(e.offerClickToken);return i}return""},H=(e,{route:i},t,n,s,o)=>{var{sponsoredListing:r}=e;if(r){var d={area:r.placement_slot_name,click_type:t,dest:n,from:i.page,impression_key:r.impression_key,is_backfill:!0,listing_key:e.listingKey,location_id:e.id,sl_line_item_id:r.sl_line_item_id,trip_ads_id:r.trip_ads_id,tt_placement:r.tt_placement,auction_offer_key:s,gosox:r.gosox};fetch(o?"/SponsoredListingCommerce/1.0/increment_click_metric":"/SponsoredListingCommerce/1.0/click",{method:"POST",headers:S(),credentials:"same-origin",body:JSON.stringify(d)}).then(e=>(e.ok||e.statusText,e)).catch(e=>{console.error(`Error sending commerce click: ${e.message}`)})}};return[()=>{e("SponsoredListingTrackingEventHandlers",_=class{clickHandler(e){var{sponsoredListing:i}=e;if(i){var t=r().getState();f(e,t.page.geoId),E(e,t,n.HOTELS_SP_CLICK),h(i),H(e,t,"HR","Hotel_Review",null,!1),w(i.partner_notification_url),T(i,g)}}visibleHandler(e){var{sponsoredListing:i}=e;if(!(!i||this.visibleHandledHotels.has(e.id))){this.visibleHandledHotels.add(e.id);var t=r().getState();v(e,t.page.geoId),E(e,t,n.HOTELS_SP_IMPRESSION),w(i.partner_impression_notification_url),T(i,m)}}clearVisibleHistory(){this.visibleHandledHotels.clear()}offerClickHandler(e,i){var{sponsoredListing:t}=e;if(t){var n=r().getState();y(e,i,n.page.geoId);var s=I(t,i),o="DISCOVERY_META_PREFERENCE"!==t.sponsored_type||s,d=L(i);o&&H(e,n,i.isInstantBook?"IB":"META",i.provider,d,s),T(t,o?g:u)}}constructor(){var e,i;e="visibleHandledHotels",i=new Set,e in this?Object.defineProperty(this,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):this[e]=i}}),e({SponsoredListingTrackingEventHandlers:_,logTripAdsClickEvent:g,logTripAdsClickUnpaidEvent:u,logTripAdsImpressionEvent:m,notifyPartner:w})},[e=>t=e.default,e=>(n=e.holisticEvents,s=e.trackHolisticEvent,o=e.trackEventWithContext),e=>r=e.getStore,e=>(d=e.requestConsent,a=e.CategoriesEnum)]]},["5gpqhx","4axon3","45ddp0","973cci"]]);
