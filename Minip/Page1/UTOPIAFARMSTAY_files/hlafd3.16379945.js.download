(this.$WP=this.$WP||[]).push(["hlafd3",(e,n)=>{var r,t,i,o,a,l,u,s,c,d,p,m,g,f,y,h,C,v,S,b,k,O,_,P,w,M,I,L,T,x,B,q,U,N,G,K,R,D,A,E,V,H,$=({onSuccess:e,onClose:n,variant:t,disableClose:i=!1,funnelKey:o,pid:a,requireSecure:c,forceLogin:d,additionalInfo:p})=>{var m=y(),{page:v}=h(),S=C(),b=s(),[k,O]=l(!0),[_,P]=l("splash"),w=()=>{m({actionType:"click",actionSubType:"OptimusLoginModalClick",itemType:"optimusLoginModalBackButton",team:"Plus",externalKey:o,pageUid:S,itemName:"OptimusLoginModal",page:v});var e=JSON.stringify({action:"back"});b.current?.contentWindow?.postMessage(e,"*")};return u(()=>{O("splash"===_)},[_,O]),r(g,{onClose:()=>{n&&n()},onBack:()=>w(),hideCloseButton:i,hideBackButton:k,overrideContentStyling:!0,children:r(f,{pid:a,funnelKey:o,onLoginSuccess:()=>{e&&e()},variant:t,requireSecure:c,forceLogin:d,additionalInfo:p,onFlowStepChange:e=>{P(e)},forwardedRef:b})})},F=()=>{var e=b(),{getDiscountCode:n}=O(),r=n(),t=!r,{subscriptionPrice:i,fetching:o}=k(e,r,t,"CHECKOUT");if(o)return null;var a=i?.trialPeriod;return(a?.numberOfDays||0)>0?"testFreeTrial":"test"},j=40777,z=["OPTIMUS_BRANDED_IMAGE_HIGHLIGHT"],J=({allowClose:e,flow:n,forceLogin:t,useValuePropVariant:i=!0,contextualMessagingVariant:u,contextualMessageKey:s,contextualMessageParamKey:m,contextualMessageParam:g,contextualMessageSubheaderKey:f,isSignInOnly:y,onClose:h,onFailure:C,funnelKey:S,pid:b=j,additionalInfoOnLoginContent:k,variantOverride:O})=>{var _=v(),{login:P,close:w}=o(),[M,I]=l({onClose:void 0,onSuccess:void 0,funnelKey:void 0,requireSecure:!1}),L=K();O&&(L=O);var T=c(()=>({...u?{}:{contextualMessage:s,contextualMessageParamKey:m,contextualMessageParam:g,contextualMessageSubheader:f},isSignInOnly:y,contextualMessagingVariant:u,funnelKey:S}),[s,g,m,f,u,y,S]),x=z.includes((n||"").toUpperCase()),B=a(()=>L&&"control"!==L?r(G,{variant:L,pid:b,funnelKey:M.funnelKey||S,onClose:M.onClose,onSuccess:M.onSuccess,disableClose:!e,requireSecure:M.requireSecure,forceLogin:M.requireSecure,additionalInfo:k}):null,{},[M]),q=d(void 0),U=p((n,r)=>_&&!t?Promise.resolve({userId:_,hasCreatedMember:null}):(q.current||(q.current=new Promise(i=>{I({onClose:()=>{e&&(B.close(),q.current=null,h&&h())},onSuccess:()=>{B.close(),n&&n(),q.current=null,i({userId:_||null,hasCreatedMember:null})},funnelKey:r,requireSecure:t}),B.open()})),q.current),[B,_,I,t,e,h]),N=k&&k.get("email")||"",R=p((r,i)=>P({flowOrigin:"login",flow:n,isFullWidthMobile:!0,forceLogin:t,requireSecure:t,closeX:e,closeOnDocClick:e,hideBoxShadow:x,extraQueryParams:{...T,funnelKey:i||S,email:N},pid:b,onSuccess:r||void 0,onClose:h,onFailure:C}),[P,n,t,e,x,T,S,b,h,C,N]);return null===L?{login:null,close:()=>{}}:{login:i&&"control"!==L?U:R,close:w}},W=({members:e,nonMembers:n,messageVariant:r,onClose:t,flow:i="OPTIMUS_BRANDED",funnelKey:o,pid:a})=>{var{isWebview:s}=_(),c=v(),d=w(),{login:m}=R({allowClose:!0,forceLogin:!1,...r&&{flow:i,contextualMessagingVariant:r},onClose:t,funnelKey:o,pid:a}),[g,f]=l(!1),{data:y,fetching:h}=P();return u(()=>{(c||s)&&g&&!h&&(f(!1),y?.isSubscribed?d(e):d(n))},[y,h,e,d,n,g,c,s]),p(()=>{c||s?f(!0):m&&m(()=>{f(!0)})},[m,f,c,s])},Q=()=>{var e=M(),{page:n}=h();return p(({locationId:r,listingKey:t=null,funnelKey:i})=>{if(!r||!i)throw Error(`Unable to record user login. Missing offer data - ${JSON.stringify({locationId:r,funnelKey:i})}`);e({OptimusOffer:{optimusInitialOfferSignedIn:{servletName:n,locationId:r,funnelKey:i,listingKey:t}}})},[e,n])},X="PlusHadBlockedCards",Y=()=>{var[e,n]=l(!1),[r,t]=l(new Map);return{failedCardPayment:p(i=>{if(i&&!e){var o=r.get(i);o||(o=0),(o+=1)>=5&&(n(!0),L.set(X,!0),o=0),t(new Map(r.set(i,o)))}},[e,n,r]),hasBlockedCardInSession:p(()=>e,[e]),hadBlockedCard:p(()=>!!e||L.has(X),[e]),clearAllBlockedCards:p(()=>{e&&n(!1),L.has(X)&&L.remove(X)},[e,n])}},Z=({children:e,forceLogin:n,loginContextualMessageKey:i,shouldLogoutAfterPaymentFailures:o=!1,renderBeforeLogout:a})=>{var{funnelKey:s}=m(I),[c,d]=l(!n),[g,f]=l(!1),y=h(),{failedCardPayment:C,hasBlockedCardInSession:S,hadBlockedCard:b,clearAllBlockedCards:k}=E(),{login:O}=R({allowClose:!1,forceLogin:n,contextualMessageKey:b()?"plus_too_many_failed_payments":i,funnelKey:s,useValuePropVariant:!b()}),_=v();u(()=>{_&&c||g||!O||(f(!0),O(()=>d(!0)).finally(()=>f(!1)))},[O,c,g,_]);var P=p(()=>{window.location.href=`/RegistrationController?flow=${encodeURIComponent("SIGN_OUT")}&pid=${encodeURIComponent(String(R))}&returnTo=${encodeURIComponent(y.path)}&fullscreen=true`},[y.path]),w=o&&S();return(u(()=>{w&&P()},[w,P]),w)?a?r(t,{children:a()}):null:_&&c?(k(),r(t,{children:e({userId:_,failedCardPayment:C})})):null},ee={__key:0xea5e6a780b3f,id:"ea5e6a780b3f7ebc",loc:{},definitions:[]},en=e=>!!e?.canAccessSecureContent,er=()=>{var e=v(),[n,r]=l(null),[t,i]=T({query:ee,pause:!e},en);return u(()=>{e!==n&&(r(e),i())},[i,n,e]),u(()=>()=>r(null),[r]),[t,i]},et=({children:e,contextualMessageKey:n,renderNotSecure:i,skip:o,allowClose:a=!1,onClose:s})=>{var{funnelKey:c}=m(I),{login:d,close:p}=R({allowClose:a,forceLogin:!0,contextualMessageKey:n,funnelKey:c,onClose:s}),[{data:g,fetching:f},y]=H(),[h,C]=l(!1);return(u(()=>{g||f||h||o||!d||d(()=>{y(),C(!0)})},[g,y,f,d,h,C,o]),u(()=>()=>p(),[p]),g||o)?r(t,{children:e()}):i?r(t,{children:i()}):null},ei=({messagingVariant:e,view:n,flow:t,bookingFlow:o,plusBrandedModal:a=!1,onLoginSuccess:l})=>{var{funnelKey:u}=m(I),{page:s}=h(),c=C(),d=U(),p=v(),{login:g}=R({allowClose:!0,funnelKey:u,useValuePropVariant:a}),f=N(),b=y();return r("div",{ref:x(()=>{f({externalKey:u,itemName:"LoginPrompt",itemType:"OptimusGuestCheckout",page:s,pageUid:c,sessionId:d,team:"Plus",userId:p,customData:JSON.stringify({view:n,flow:t,checkoutType:"PAGE",booking_flow:o})})}),children:i(q,{variant:"title-05",children:["member"===e?r(S,{id:"member_login_prompt_already_ta_member"}):r(S,{id:"member_login_prompt_already_plus_member"}),r(B,{onClick:()=>{b({actionType:"click",externalKey:u,itemGroup:n,itemName:"LoginPrompt",itemType:"OptimusGuestCheckout",page:s,pageUid:c,sessionId:d,team:"Plus",userId:p,customData:JSON.stringify({checkoutType:"PAGE",view:n,flow:t,loginType:a?"plus":"default",booking_flow:o})}),g&&g(l)},marginLeft:"spacing-01",disabled:null===g,children:r(S,{id:"member_login_prompt_sign_in"})})]})})};return[()=>{G=$,K=F,R=J,D=W,A=Q,E=Y,V=Z,H=er,e({MemberLoginPrompt:ei,OptimusHardGate:V,OptimusSecureLoginGate:et,useOptimusLogin:R,useOptimusLoginNavigation:D,useOptimusLoginTracking:A})},[e=>(r=e.jsx,t=e.Fragment,i=e.jsxs),e=>o=e.default,e=>a=e.useVDOMPortal,e=>(l=e.useState,u=e.useEffect,s=e.createRef,c=e.useMemo,d=e.useRef,p=e.useCallback,m=e.useContext),e=>g=e.ModalContainer,e=>f=e.default,e=>y=e.default,e=>(h=e.useRoute,C=e.usePageviewUid),e=>v=e.useUserId,e=>(S=e.default,b=e.useCurrency),e=>k=e.useOptimusSubscriptionPriceQuery,e=>O=e.useDiscountCodePersistance,e=>_=e.useUserAgent,e=>P=e.useOptimusSubscriptionStatusRaw,e=>w=e.useNavigate,e=>M=e.useInteractionLogger,e=>I=e.FunnelTracking,e=>L=e.default,e=>T=e.default,e=>x=e.useOnVisible,e=>B=e.BorderlessButton,e=>q=e.default,e=>U=e.useSessionId,e=>N=e.default]]},["21h32l","rdycz1","4euaes","o4yt4q","i3sz5h","l8km37","r73jw8","fgwvq1","52far5","7thqz4","i9ixrv","36016d","nnprhg","g6kunc","0ad67e","32pwc7","kkqcv8","9b9b10","l47ri7","3btuy0","jppfwt","essqvy","al4vil","xg719z"]]);
