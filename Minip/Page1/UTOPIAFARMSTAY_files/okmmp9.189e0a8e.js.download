(this.$WP=this.$WP||[]).push(["okmmp9",(t,e)=>{var i,r,s,n,o,a,l,u,h,c,d,g,f,v,p,m,b,y,w,S,_,I,A,D,T,N,O,k,E,C,R,x,B,P,$,q,U,L,j,F,M,G,J,H,z,W,Y,V,Z,K,X,Q,tt,te,ti,tr,ts={Pn:function(t){for(var e=atob((t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/")),i=new Uint8Array(e.length),r=0;r<e.length;++r)i[r]=e.charCodeAt(r);return i}},tn={CustomEvent:"ce",Pr:"p",xl:"pc",cc:"ca",Ba:"i",qs:"ie",T:"cci",W:"ccic",_:"ccc",L:"ccd",_h:"ss",gh:"se",bi:"si",yi:"sc",ji:"sbc",vi:"sfe",ro:"iec",Ul:"lr",Ol:"uae",U:"ci",F:"cc",Bl:"lcaa",Wl:"lcar",Tn:"inc",En:"add",Fn:"rem",Un:"set",Gl:"sgu"},to={qr:"feed_displayed",dc:"content_cards_displayed"},ta={nt:()=>{var t=t=>{var e=(Math.random().toString(16)+"000000000").substr(2,8);return t?"-"+e.substr(0,4)+"-"+e.substr(4,4):e};return t()+t(!0)+t(!0)+t()}},tl={init:function(t){void 0===t&&void 0!==tl.zg||(tl.zg=!!t),tl.Eg||(tl.Eg=!0)},destroy:function(){tl.Eg=!1,tl.zg=void 0,tl.nd=void 0},setLogger:function(t){"function"==typeof t?(tl.init(),tl.nd=t):tl.info("Ignoring setLogger call since logger is not a function")},toggleLogging:function(){tl.init(),tl.zg?tl.zg=!1:tl.zg=!0},info:function(t){if(tl.zg){var e="Braze: "+t;null!=tl.nd?tl.nd(e):console.log(e)}},warn:function(t){if(tl.zg){var e="Braze SDK Warning: "+t+" (v4.6.3)";null!=tl.nd?tl.nd(e):console.warn(e)}},error:function(t){if(tl.zg){var e="Braze SDK Error: "+t+" (v4.6.3)";null!=tl.nd?tl.nd(e):console.error(e)}}},tu={ho:"allowCrawlerActivity",po:"baseUrl",Eo:"noCookies",_o:"devicePropertyAllowlist",ta:"disablePushTokenMaintenance",Io:"enableLogging",Ao:"enableSdkAuthentication",ia:"manageServiceWorkerExternally",So:"minimumIntervalBetweenTriggerActionsInSeconds",No:"sessionTimeoutInSeconds",wo:"appVersion",na:"serviceWorkerLocation",ra:"safariWebsitePushId",zn:"localization",ao:"contentSecurityNonce",To:"enableHtmlInAppMessages",Oo:"allowUserSuppliedJavascript",no:"inAppMessageZIndex",lo:"openInAppMessagesInNewTab",en:"openNewsFeedCardsInNewTab",eh:"requireExplicitInAppMessageDismissal",vo:"doNotLoadFontAwesome",Co:"sdkFlavor",tn:"openCardsInNewTab"};function th(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&void 0!==t[i]&&e.push(t[i]);return e}function tc(t,e,i,r){var s=th(t);return -1!==s.indexOf(e)||(W.D.error(`${i} Valid values from ${r} are "${s.join('"/"')}".`),!1)}function td(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)}function tg(t){return"[object Date]"===Object.prototype.toString.call(t)}function tf(t){return"[object Object]"===Object.prototype.toString.call(t)}function tv(t){null==t&&(t=[]);for(var e=[],i=arguments.length,r=0,s=t.length;r<s;r++){var n=t[r];if(-1===e.indexOf(n)){var o=1;for(o=1;o<i&&-1!==arguments[o].indexOf(n);o++);o===i&&e.push(n)}}return e}function tp(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e}function tm(t,e){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;var i=t.toString();if(i!==e.toString())return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e}var r="[object Array]"===i;if(!r){if("object"!=typeof t||"object"!=typeof e)return!1;var s=t.constructor,n=e.constructor;if(s!==n&&!("function"==typeof s&&s instanceof s&&"function"==typeof n&&n instanceof n)&&"constructor"in t&&"constructor"in e)return!1}for(var o=[],a=[],l=o.length;l--;)if(o[l]===t)return a[l]===e;if(o.push(t),a.push(e),r){if((l=t.length)!==e.length)return!1;for(;l--;)if(!tm(t[l],e[l]))return!1}else{var u,h=tp(t);if(l=h.length,tp(e).length!==l)return!1;for(;l--;)if(u=h[l],!e.hasOwnProperty(u)||!tm(t[u],e[u]))return!1}return o.pop(),a.pop(),!0}function tb(t,e){var i=t/1e3;return e&&(i=Math.floor(i)),i}function ty(t){var e=parseInt(t);return null==t||isNaN(e)?null:new Date(1e3*e)}function tw(t){return null!=t&&tg(t)?t.toISOString().replace(/\.[0-9]{3}Z$/,""):t}function tS(t){return null==t||""===t?null:new Date(t)}function t_(t){return(new Date().valueOf()-t.valueOf())/1e3}function tI(t){return(t.valueOf()-new Date().valueOf())/1e3}var tA={rE:"Chrome",eE:"Edge",Pg:"Internet Explorer",EE:"Opera",kg:"Safari",oE:"Firefox"},tD={Fg:"Android",ln:"iOS",jg:"Mac",Dg:"Windows"};function tT(t){for(var e=t.length,i=t.length-1;i>=0;i--){var r=t.charCodeAt(i);r>127&&r<=2047?e++:r>2047&&r<=65535&&(e+=2),r>=56320&&r<=57343&&i--}return e}var tN={types:{ue:"container",logCustomEvent:"logCustomEvent",setEmailNotificationSubscriptionType:"setEmailNotificationSubscriptionType",setPushNotificationSubscriptionType:"setPushNotificationSubscriptionType",setCustomUserAttribute:"setCustomUserAttribute",requestPushPermission:"requestPushPermission",addToSubscriptionGroup:"addToSubscriptionGroup",removeFromSubscriptionGroup:"removeFromSubscriptionGroup",addToCustomAttributeArray:"addToCustomAttributeArray",removeFromCustomAttributeArray:"removeFromCustomAttributeArray",de:"openLink",pe:"openLinkInWebView"},properties:{type:"type",me:"steps",fe:"args"}},tO={Di:"unknownBrazeAction",_i:"noPushPrompt"},tk=(t,e)=>{switch(t){case tO.Di:return`${e} contains an unknown braze action type and will not be displayed.`;case tO._i:return`${e} contains a push prompt braze action, but is not eligible for a push prompt. Ignoring.`;default:return""}};function tE(t){try{var e=t.match(tB)[0].length,i=t.substring(e);if(e>t.length-1||!i)return void W.D.error(`Did not find base64 encoded brazeAction in url to process : ${t}`);var r=function(t){try{t=t.replace(/-/g,"+").replace(/_/g,"/");for(var e=window.atob(t),i=new Uint8Array(e.length),r=0;r<e.length;r++)i[r]=e.charCodeAt(r);var s=new Uint16Array(i.buffer);return String.fromCharCode(...s)}catch(t){return W.D.error("Unable to decode Base64: "+t),null}}(i);return r?JSON.parse(r):void W.D.error(`Failed to decode base64 encoded brazeAction: ${i}`)}catch(e){return void W.D.error(`Failed to process brazeAction URL ${t} : ${e.message}`)}}function tC(t,e){var i=!1;for(var r of e)if(i=i||t(r))return!0;return!1}function tR(t){try{var e,i=t[tN.properties.type];return i===tN.types.ue?tC(tR,t[tN.properties.me]):(e=!1,Object.keys(tN.types).forEach(t=>{tN.types[t]!==i.toString()||(e=!0)}),!e)}catch(t){return!0}}var tx=/^[^\x00-\x1F\x22]+$/,tB=/^brazeActions:\/\/v\d+\//;function tP(t){var e=typeof t;return null==t||"number"===e||"boolean"===e||tg(t)||"string"===e}function t$(t,e,i,r){var s="string"==typeof t||null===t&&r;return s||W.D.error(`Cannot ${e} because ${i} "${t}" is invalid.`),s}function tq(t,e,i){var r=null!=t&&"string"==typeof t&&(""===t||t.match(tx));return r||W.D.error(`Cannot ${e} because ${i} "${t}" is invalid.`),r}function tU(t,e,i,r,s){if(null==t&&(t={}),"object"!=typeof t||td(t))return W.D.error(`${e} requires that ${i} be an object. Ignoring ${s}.`),[!1,null];var n,o=JSON.stringify(t);if(tT(o)>51200)return W.D.error(`Could not ${r} because ${i} was greater than the max size of 50KB.`),[!1,null];try{n=JSON.parse(o)}catch(t){return W.D.error(`Could not ${r} because ${i} did not contain valid JSON.`),[!1,null]}for(var a in t){if(!tq(a,r,`the ${s} property name`))return[!1,null];var l=t[a];if(null==l){delete t[a],delete n[a];continue}if(tg(l)&&(n[a]=tw(l)),!function(t,e,i,r){var s;return(s=tf(t)||td(t)?function t(e,i){if(td(e)&&td(i)){for(var r=0;r<e.length&&r<i.length;r++)if(tg(e[r])&&(i[r]=tw(e[r])),!t(e[r],i[r]))return!1}else{if(!tf(e))return tP(e);for(var s of tp(e))if(tg(e[s])&&(i[s]=tw(e[s])),!t(e[s],i[s]))return!1}return!0}(t,e):tP(t))||W.D.error(`Cannot ${i} because ${r} "${t}" is invalid.`),s}(l,n[a],r,`the ${s} property "${a}"`))return[!1,null]}return[!0,n]}function tL(t){if(!(tN.properties.type in t))return!1;switch(t[tN.properties.type]){case tN.types.ue:if(tN.properties.me in t)return!0;break;case tN.types.logCustomEvent:case tN.types.setEmailNotificationSubscriptionType:case tN.types.setPushNotificationSubscriptionType:case tN.types.setCustomUserAttribute:case tN.types.addToSubscriptionGroup:case tN.types.removeFromSubscriptionGroup:case tN.types.addToCustomAttributeArray:case tN.types.removeFromCustomAttributeArray:case tN.types.de:case tN.types.pe:if(tN.properties.fe in t)return!0;break;case tN.types.requestPushPermission:return!0}return!1}var tj={eu:{su:"ab.storage.userId",Jo:"ab.storage.deviceId",Sh:"ab.storage.sessionId"},q:{Sa:"ab.test",Ta:"ab.storage.events",Ia:"ab.storage.attributes",Ka:"ab.storage.attributes.anonymous_user",Yo:"ab.storage.device",ha:"ab.storage.sdk_metadata",ca:"ab.storage.session_id_for_cached_metadata",Sn:"ab.storage.pushToken",ei:"ab.storage.newsFeed",hi:"ab.storage.lastNewsFeedRefresh",P:"ab.storage.cardImpressions",hl:"ab.storage.serverConfig",Ya:"ab.storage.triggers",Da:"ab.storage.triggers.ts",bh:"ab.storage.messagingSessionStart",Yt:"ab.storage.cc",vs:"ab.storage.ccLastFullSync",ys:"ab.storage.ccLastCardUpdated",$:"ab.storage.ccClicks",O:"ab.storage.ccImpressions",K:"ab.storage.ccDismissals",Ga:"ab.storage.lastDisplayedTriggerTimesById",Na:"ab.storage.lastDisplayedTriggerTime",va:"ab.storage.triggerFireInstancesById",Qn:"ab.storage.signature",As:"ab.storage.brazeSyncRetryCount",_s:"ab.storage.sdkVersion",ze:"ab.storage.ff",Ce:"ab.storage.ffLastRefreshAt"},ae:"ab.optOut"},tF={BROWSER:"browser",BROWSER_VERSION:"browserVersion",OS:"os",RESOLUTION:"resolution",LANGUAGE:"language",TIME_ZONE:"timeZone",USER_AGENT:"userAgent"};function tM(t,e,i){var r=`The '${t}' ${e} is deprecated.`;i&&(r+=` Please use '${i}' instead.`),W.D.warn(r)}var tG={Ra:"invalid_api_key",ba:"blacklisted",ga:"no_device_identifier",pa:"invalid_json_response",ma:"empty_response"},tJ={Hs:t=>{var e,i;try{if(window.XMLHttpRequest?e=new XMLHttpRequest:W.D.error("This browser does not have any supported ajax options!"),null!=e){var r=()=>{"function"==typeof t.error&&t.error(e.status),"function"==typeof t.Ue&&t.Ue(!1)};for(var s of(e.onload=()=>{var i,s;if(4===e.readyState){if(e.status>=200&&e.status<300||304===e.status){if("function"==typeof t.S){try{i=JSON.parse(e.responseText),s=e.getAllResponseHeaders()}catch(i){var n={error:""===e.responseText?tG.ma:tG.pa,response:e.responseText};t.S(n,s)}i&&t.S(i,s)}"function"==typeof t.Ue&&t.Ue(!0)}else r()}},e.onerror=()=>{r()},e.ontimeout=()=>{r()},i=JSON.stringify(t.data),e.open("POST",t.url,!0),e.setRequestHeader("Content-type","application/json"),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.headers||[]))e.setRequestHeader(s[0],s[1]);e.send(i)}}catch(t){W.D.error(`Network request error: ${t.message}`)}}},tH=t=>{var e,i,r={},s=t.toString().split("\r\n");if(!s)return r;for(var n of s)n&&(e=n.slice(0,n.indexOf(":")).toLowerCase().trim(),i=n.slice(n.indexOf(":")+1).trim(),r[e]=i);return r},tz=(t,e)=>(t=Math.ceil(t),Math.floor(Math.random()*((e=Math.floor(e))-t+1))+t),tW={Yr:()=>"serviceWorker"in navigator&&"undefined"!=typeof ServiceWorkerRegistration&&"showNotification"in ServiceWorkerRegistration.prototype&&"PushManager"in window,Hr:()=>"safari"in window&&"pushNotification"in window.safari&&"function"==typeof window.safari.pushNotification.permission&&"function"==typeof window.safari.pushNotification.requestPermission,isPushSupported:()=>tW.Yr()||tW.Hr(),isPushBlocked:()=>{var t=tW.isPushSupported()&&"Notification"in window&&null!=window.Notification&&null!=window.Notification.permission&&"denied"===window.Notification.permission,e=tW.isPushSupported()&&(!("Notification"in window)||null==window.Notification);return t||e},isPushPermissionGranted:()=>tW.isPushSupported()&&"Notification"in window&&null!=window.Notification&&null!=window.Notification.permission&&"granted"===window.Notification.permission,Ti:()=>!tW.isPushBlocked()&&tW.isPushSupported()&&!tW.isPushPermissionGranted()},tY={Vo:(t,e)=>{var i=!1;try{if(localStorage&&localStorage.getItem)try{localStorage.setItem(tj.q.Sa,!0),localStorage.getItem(tj.q.Sa)&&(localStorage.removeItem(tj.q.Sa),i=!0)}catch(t){if("QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||!(localStorage.length>0))throw t;i=!0}}catch(t){W.D.info("Local Storage not supported!")}var r=tY.Ea(),s=new c.wa(t,r&&!e,i),n=null;return n=i?new c._a(t):new c.Oa,new c(s,n)},Ea:()=>navigator.cookieEnabled||"cookie"in document&&(document.cookie.length>0||(document.cookie="test").indexOf.call(document.cookie,"test")>-1)};function tV(t,e,i,r){if(null==t)return!1;e=e||!1,i=i||!1;var s=t.getBoundingClientRect();return null!=s&&(s.top>=0&&s.top<=(window.innerHeight||document.documentElement.clientHeight)||!e)&&(s.left>=0||!r)&&(s.bottom>=0&&s.bottom<=(window.innerHeight||document.documentElement.clientHeight)||!i)&&(s.right<=(window.innerWidth||document.documentElement.clientWidth)||!r)}var tZ={We:"up",Xe:"down",ot:"left",et:"right"};function tK(){if(null==Q.vu){Q.vu=!1;try{var t=Object.defineProperty({},"passive",{get:()=>{Q.vu=!0}});window.addEventListener("testPassive",null,t),window.removeEventListener("testPassive",null,t)}catch(t){}}return Q.vu}function tX(t,e,i){t.addEventListener(e,i,!!tK()&&{passive:!0})}function tQ(t){return Q.eo(t,!0,!1,!1)}function t0(t){return Q.eo(t,!1,!0,!1)}function t1(t){if(t.onclick){var e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),t.onclick.apply(t,[e])}}function t3(t,e,i){var r=null,s=null;tX(t,"touchstart",t=>{r=t.touches[0].clientX,s=t.touches[0].clientY}),tX(t,"touchmove",n=>{if(null!=r&&null!=s){var o=r-n.touches[0].clientX,a=s-n.touches[0].clientY;Math.abs(o)>Math.abs(a)&&Math.abs(o)>=25?((o>0&&e===tZ.ot||o<0&&e===tZ.et)&&i(n),r=null,s=null):Math.abs(a)>=25&&((a>0&&e===tZ.We&&t.scrollTop===t.scrollHeight-t.offsetHeight||a<0&&e===tZ.Xe&&0===t.scrollTop)&&i(n),r=null,s=null)}})}function t2(t,e,i){var r="http://www.w3.org/2000/svg",s=document.createElementNS(r,"svg");s.setAttribute("viewBox",t),s.setAttribute("xmlns",r);var n=document.createElementNS(r,"path");return n.setAttribute("d",e),null!=i&&n.setAttribute("fill",i),s.appendChild(n),s}var t4={fo:32,oo:9,co:13,ih:27};function t5(t){if(t.is_control)return _.fromJson(t);var e=t.type;null!=e&&(e=e.toUpperCase());var i=t.message,r=t.text_align_message,s=t.slide_from,n=t.extras,o=t.trigger_id,a=t.click_action,l=t.uri,u=t.open_target,h=t.message_close,c=t.duration,d=t.icon,g=t.image_url,f=t.image_style,v=t.icon_color,p=t.icon_bg_color,m=t.bg_color,b=t.text_color,y=t.close_btn_color,w=t.header,S=t.text_align_header,k=t.header_text_color,E=t.frame_color,C=[],R=t.btns;null==R&&(R=[]);for(var x=0;x<R.length;x++)C.push(D.fromJson(R[x]));var B,P=t.crop_type,$=t.orientation,q=t.animate_in,U=t.animate_out,L=t.html_id,j=t.css;if(null!=L&&""!==L&&null!=j&&""!==j||(L=void 0,j=void 0),e===N.es||e===I.es.Ye)B=new N(i,r,n,o,a,l,u,h,c,d,g,f,v,p,m,b,y,q,U,w,S,k,E,C,P,L,j);else if(e===T.es)B=new T(i,r,n,o,a,l,u,h,c,d,g,f,v,p,m,b,y,q,U,w,S,k,E,C,P,$,L,j);else if(e===O.es)B=new O(i,r,s,n,o,a,l,u,h,c,d,g,v,p,m,b,y,q,U,L,j);else{if(e!==A.es&&e!==I.es.cn)return void W.D.error("Ignoring message with unknown type "+e);var F=t.message_fields;(B=new A(i,n,o,h,c,q,U,E,L,j,F)).trusted=t.trusted||!1}return B.un=e,B}var t6={OPEN:"open",Rr:"purchase",vr:"push_click",be:"custom_event",Br:"iam_click",ks:"test"},t8={Ze:null,t:!1,m:()=>(t8.o(),t8.Ze||(t8.Ze=new L(ti.nr(),ti.g(),ti.l(),ti.p())),t8.Ze),o:()=>{t8.t||(ti.u(t8),t8.t=!0)},destroy:()=>{t8.Ze=null,t8.t=!1}},t9={PORTRAIT:0,LANDSCAPE:1};function t7(){return screen.width<=600}function et(){if("orientation"in window)return 90===Math.abs(window.orientation)||270===window.orientation?t9.LANDSCAPE:t9.PORTRAIT;if("screen"in window){var t=window.screen.orientation||screen.mozOrientation||screen.msOrientation;return null!=t&&"object"==typeof t&&(t=t.type),"landscape-primary"===t||"landscape-secondary"===t?t9.LANDSCAPE:t9.PORTRAIT}return t9.PORTRAIT}function ee(t,e,i){e||null!=i&&i.metaKey?window.open(t):window.location=t}function ei(){return window.location.href}function er(t){null==t&&(t="");var e=t.split("?").slice(1).join("?"),i={};if(null!=e)for(var r=e.split("&"),s=0;s<r.length;s++){var n=r[s].split("=");""!==n[0]&&(i[n[0]]=n[1])}return i}function es(t){return!(!t||0!==(t=t.toString().toLowerCase()).lastIndexOf("javascript:",0)&&0!==t.lastIndexOf("data:",0))}var en={t:!1,provider:null,er:()=>(en.init(),en.provider),rg:()=>{if(!en.provider){var t=ti.nn(eo.So);en.provider=new F(null!=t?t:30,tt.m().pi(),ti.l(),ti.mr(),tt.m()),ti.ar(en.provider)}},init:()=>{en.t||(en.rg(),ti.u(en),en.t=!0)},destroy:()=>{en.provider=null,en.t=!1}},eo={ho:"allowCrawlerActivity",po:"baseUrl",Eo:"noCookies",_o:"devicePropertyAllowlist",ta:"disablePushTokenMaintenance",Io:"enableLogging",Ao:"enableSdkAuthentication",ia:"manageServiceWorkerExternally",So:"minimumIntervalBetweenTriggerActionsInSeconds",No:"sessionTimeoutInSeconds",wo:"appVersion",na:"serviceWorkerLocation",ra:"safariWebsitePushId",zn:"localization",ao:"contentSecurityNonce",To:"enableHtmlInAppMessages",Oo:"allowUserSuppliedJavascript",no:"inAppMessageZIndex",lo:"openInAppMessagesInNewTab",tn:"openCardsInNewTab",en:"openNewsFeedCardsInNewTab",eh:"requireExplicitInAppMessageDismissal",vo:"doNotLoadFontAwesome",Co:"sdkFlavor"},ea={G:(t,e,i)=>{var r=new m,s=ti.g();if(!s)return W.D.info(`Not logging event with type "${t}" because the current session ID could not be found.`),r;var n=s.mo();return r.ve.push(new l(i||ti.p().getUserId(),t,new Date().valueOf(),n,e)),r.S=ti.l().bo(r.ve),r}};return t({$:tv,E:tR,L:tQ,N:t0,P:tM,Q:tc,R:tT,X:t$,Z:tq,_:tU,a:tX,a4:tm,b:t2,c:tb,d:ty,g:tE,i:tL,j:er,k:tp,m:t3,q:es,w:td,x:tS}),[()=>{J=ts,H=ta,(i=class{constructor(t,e){this.td="undefined"==typeof window?self:window,this.ed=t,this.nd=e}od(){if("indexedDB"in this.td)return this.td.indexedDB}rd(){try{if(null==this.od())return!1;var t=this.od().open("Braze IndexedDB Support Test");if(t.onupgradeneeded=()=>t.result.close(),t.onsuccess=()=>t.result.close(),"undefined"!=typeof window){var e=window.chrome||window.browser||window.msBrowser;if(e&&e.runtime&&e.runtime.id)return this.nd.info("Not using IndexedDB for storage because we are running inside an extension"),!1}return!0}catch(t){return this.nd.info("Not using IndexedDB for storage due to following error: "+t),!1}}sd(t,e){var i=this.od().open(this.ed.dd,this.ed.VERSION);if(null==i)return"function"==typeof e&&e(),!1;var r=this;return i.onupgradeneeded=t=>{r.nd.info("Upgrading indexedDB "+r.ed.dd+" to v"+r.ed.VERSION+"...");var e=t.target.result;for(var i in r.ed.$t)r.ed.$t.hasOwnProperty(i)&&!e.objectStoreNames.contains(r.ed.$t[i])&&e.createObjectStore(r.ed.$t[i])},i.onsuccess=i=>{var s=i.target.result;s.onversionchange=()=>{s.close(),"function"==typeof e&&e(),r.nd.error("Needed to close the database unexpectedly because of an upgrade in another tab")},t(s)},i.onerror=t=>(r.nd.info("Could not open indexedDB "+r.ed.dd+" v"+r.ed.VERSION+": "+t.target.errorCode),"function"==typeof e&&e(),!0),!0}setItem(t,e,i,r,s){if(!this.rd())return"function"==typeof s&&s(),!1;var n=this;return this.sd(o=>{if(!o.objectStoreNames.contains(t))return n.nd.error("Could not store object "+e+" in "+t+" on indexedDB "+n.ed.dd+" - "+t+" is not a valid objectStore"),"function"==typeof s&&s(),void o.close();var a=o.transaction([t],"readwrite");a.oncomplete=()=>o.close();var l=a.objectStore(t).put(i,e);l.onerror=()=>{n.nd.error("Could not store object "+e+" in "+t+" on indexedDB "+n.ed.dd),"function"==typeof s&&s()},l.onsuccess=()=>{"function"==typeof r&&r()}},s)}getItem(t,e,i){if(!this.rd())return!1;var r=this;return this.sd(s=>{if(!s.objectStoreNames.contains(t))return r.nd.error("Could not retrieve object "+e+" in "+t+" on indexedDB "+r.ed.dd+" - "+t+" is not a valid objectStore"),void s.close();var n=s.transaction([t],"readonly");n.oncomplete=()=>s.close();var o=n.objectStore(t).get(e);o.onerror=()=>{r.nd.error("Could not retrieve object "+e+" in "+t+" on indexedDB "+r.ed.dd)},o.onsuccess=t=>{var e=t.target.result;null!=e&&i(e)}})}hr(t,e,i){if(!this.rd())return"function"==typeof i&&i(),!1;var r=this;return this.sd(s=>{if(!s.objectStoreNames.contains(t))return r.nd.error("Could not retrieve last record from "+t+" on indexedDB "+r.ed.dd+" - "+t+" is not a valid objectStore"),"function"==typeof i&&i(),void s.close();var n=s.transaction([t],"readonly");n.oncomplete=()=>s.close();var o=n.objectStore(t).openCursor(null,"prev");o.onerror=()=>{r.nd.error("Could not open cursor for "+t+" on indexedDB "+r.ed.dd),"function"==typeof i&&i()},o.onsuccess=t=>{var r=t.target.result;null!=r&&null!=r.value&&null!=r.key?e(r.key,r.value):"function"==typeof i&&i()}},i)}br(t,e){if(!this.rd())return!1;var i=this;return this.sd(r=>{if(!r.objectStoreNames.contains(t))return i.nd.error("Could not delete record "+e+" from "+t+" on indexedDB "+i.ed.dd+" - "+t+" is not a valid objectStore"),void r.close();var s=r.transaction([t],"readwrite");s.oncomplete=()=>r.close(),s.objectStore(t).delete(e).onerror=()=>{i.nd.error("Could not delete record "+e+" from "+t+" on indexedDB "+i.ed.dd)}})}Jt(t,e){if(!this.rd())return!1;var i=this;return this.sd(r=>{if(!r.objectStoreNames.contains(t))return i.nd.error("Could not retrieve objects from "+t+" on indexedDB "+i.ed.dd+" - "+t+" is not a valid objectStore"),void r.close();var s=r.transaction([t],"readwrite");s.oncomplete=()=>r.close();var n=s.objectStore(t),o=n.openCursor(),a=[];o.onerror=()=>{a.length>0?(i.nd.info("Cursor closed midway through for "+t+" on indexedDB "+i.ed.dd),e(a)):i.nd.error("Could not open cursor for "+t+" on indexedDB "+i.ed.dd)},o.onsuccess=t=>{var i=t.target.result;null!=i?(null!=i.value&&null!=i.key&&(n.delete(i.key).onsuccess=()=>{a.push(i.value)}),i.continue()):a.length>0&&e(a)}})}clearData(){if(!this.rd())return!1;var t=[];for(var e in this.ed.$t)this.ed.$t.hasOwnProperty(e)&&this.ed.$t[e]!==this.ed.$t.oe&&t.push(this.ed.$t[e]);var i=this;return this.sd(function(e){var r=e.transaction(t,"readwrite");r.oncomplete=()=>e.close();for(var s=0;s<t.length;s++){var n=t[s];r.objectStore(n).clear().onerror=function(){i.nd.error("Could not clear "+this.source.name+" on indexedDB "+i.ed.dd)}}r.onerror=function(){i.nd.error("Could not clear object stores on indexedDB "+i.ed.dd)}})}}).ep={Ft:{dd:"AppboyServiceWorkerAsyncStorage",VERSION:6,$t:{Kl:"data",jr:"pushClicks",cu:"pushSubscribed",ud:"fallbackDevice",Mt:"cardUpdates",oe:"optOut",$r:"pendingData",Vn:"sdkAuthenticationSignature"},se:1}},z=tl,W={Dn:J,A:tn,Ar:to,it:H,qt:i,xt:i.ep,D:z,Go:tu},t("u",r=class{constructor(){this.ni={}}ut(t){if("function"!=typeof t)return null;var e=W.it.nt();return this.ni[e]=t,e}removeSubscription(t){delete this.ni[t]}removeAllSubscriptions(){this.ni={}}bu(){return Object.keys(this.ni).length}St(t){var e=[];for(var i in this.ni)e.push(this.ni[i](t));return e}}),s=class{constructor(){}tf(){}ef(){}Zo(t){}static rf(t,e){if(t&&e){if(t=t.toLowerCase(),td(e.if)){for(var i=0;i<e.if.length;i++)if(-1!==t.indexOf(e.if[i].toLowerCase()))return e.identity}else if(-1!==t.indexOf(e.if.toLowerCase()))return e.identity}}},n=class t extends s{constructor(){if(super(),this.userAgentData=navigator.userAgentData,this.userAgentData){var t=this.ic();this.browser=t.browser||"Unknown Browser",this.version=t.version||"Unknown Version"}}tf(){return this.browser}ef(){return this.version}Zo(e){if(this.OS)return Promise.resolve(this.OS);var i=i=>{for(var r=0;r<e.length;r++){var s=t.rf(i,e[r]);if(s)return this.OS=s,this.OS}return i};return this.userAgentData.platform?Promise.resolve(i(this.userAgentData.platform)):this.nc().then(t=>i(t.platform)).catch(()=>navigator.platform)}ic(){var t={},e=this.userAgentData.brands;if(e&&e.length)for(var i of e){var r=this.oc(tA),s=i.brand.match(r);if(s&&s.length>0){t.browser=s[0],t.version=i.version;break}}return t}oc(t){var e=[];for(var i in t)t[i]!==tA.Pg&&e.push(t[i]);return RegExp("("+e.join("|")+")","i")}nc(){return this.userAgentData.getHighEntropyValues?this.userAgentData.getHighEntropyValues(["platform"]):Promise.reject()}},o=class t extends s{constructor(){super(),this.Su=t.Vu(navigator.userAgent||"")}tf(){return this.Su[0]||"Unknown Browser"}ef(){return this.Su[1]||"Unknown Version"}Zo(e){for(var i=0;i<e.length;i++){var r=e[i].string,s=t.rf(r,e[i]);if(s)return s===tD.jg&&navigator.maxTouchPoints>1&&(s=tD.ln),Promise.resolve(s)}return Promise.resolve(navigator.platform)}static Vu(t){var e,i=t.match(/(samsungbrowser|tizen|roku|konqueror|icab|crios|opera|ucbrowser|chrome|safari|firefox|camino|msie|trident(?=\/))\/?\s*(\.?\d+(\.\d+)*)/i)||[];if(/trident/i.test(i[1]))return e=/\brv[ :]+(\.?\d+(\.\d+)*)/g.exec(t)||[],[tA.Pg,e[1]||""];if(-1!==t.indexOf("(Web0S; Linux/SmartTV)"))return["LG Smart TV",null];if(-1!==t.indexOf("CrKey"))return["Chromecast",null];if(-1!==t.indexOf("BRAVIA")||-1!==t.indexOf("SonyCEBrowser")||-1!==t.indexOf("SonyDTV"))return["Sony Smart TV",null];if(-1!==t.indexOf("PhilipsTV"))return["Philips Smart TV",null];if(t.match(/\b(Roku)\b/))return["Roku",null];if(t.match(/\bAFTM\b/))return["Amazon Fire Stick",null];if(i[1]===tA.rE&&null!=(e=t.match(/\b(OPR|Edge|EdgA|Edg|UCBrowser)\/(\.?\d+(\.\d+)*)/)))return(e=e.slice(1))[0]=e[0].replace("OPR",tA.EE),e[0]=e[0].replace("EdgA",tA.eE),"Edg"===e[0]&&(e[0]=tA.eE),[e[0],e[1]];if(i[1]===tA.kg&&null!=(e=t.match(/\b(EdgiOS)\/(\.?\d+(\.\d+)*)/)))return(e=e.slice(1))[0]=e[0].replace("EdgiOS",tA.eE),[e[0],e[1]];if((i=i[2]?[i[1],i[2]]:[null,null])[0]===tA.kg&&null!=(e=t.match(/version\/(\.?\d+(\.\d+)*)/i))&&i.splice(1,1,e[1]),null!=(e=t.match(/\b(UCBrowser)\/(\.?\d+(\.\d+)*)/))&&i.splice(1,1,e[2]),i[0]===tA.EE&&null!=(e=t.match(/mini\/(\.?\d+(\.\d+)*)/i)))return["Opera Mini",e[1]||""];if(i[0]){var r=i[0].toLowerCase();"msie"===r&&(i[0]=tA.Pg),"crios"===r&&(i[0]=tA.rE),"tizen"===r&&(i[0]="Samsung Smart TV",i[1]=null),"samsungbrowser"===r&&(i[0]="Samsung Browser")}return i}},(a=class t{constructor(){var e=navigator.userAgentData?n:o;this.Sg=new e,this.userAgent=navigator.userAgent,this.browser=this.Sg.tf(),this.version=this.Sg.ef(),this.Zo().then(t=>this.OS=t),this.language=(navigator.userLanguage||navigator.language||navigator.browserLanguage||navigator.systemLanguage||"").toLowerCase(),this.Fo=t.Bg(this.userAgent)}Og(){return this.browser!==tA.Pg||this.version>8}ka(){return this.browser===tA.kg}Xo(){return this.OS||null}Zo(){return this.OS?Promise.resolve(this.OS):this.Sg.Zo(t.xg).then(t=>(this.OS=t,t))}static Bg(t){t=t.toLowerCase();for(var e=["googlebot","bingbot","slurp","duckduckbot","baiduspider","yandex","facebookexternalhit","sogou","ia_archiver","https://github.com/prerender/prerender","aolbuild","bingpreview","msnbot","adsbot","mediapartners-google","teoma"],i=0;i<e.length;i++)if(-1!==t.indexOf(e[i]))return!0;return!1}}).xg=[{string:navigator.platform,if:"Win",identity:tD.Dg},{string:navigator.platform,if:"Mac",identity:tD.jg},{string:navigator.platform,if:"BlackBerry",identity:"BlackBerry"},{string:navigator.platform,if:"FreeBSD",identity:"FreeBSD"},{string:navigator.platform,if:"OpenBSD",identity:"OpenBSD"},{string:navigator.platform,if:"Nintendo",identity:"Nintendo"},{string:navigator.platform,if:"SunOS",identity:"SunOS"},{string:navigator.platform,if:"PlayStation",identity:"PlayStation"},{string:navigator.platform,if:"X11",identity:"X11"},{string:navigator.userAgent,if:["iPhone","iPad","iPod"],identity:tD.ln},{string:navigator.platform,if:"Pike v",identity:tD.ln},{string:navigator.userAgent,if:["Web0S"],identity:"WebOS"},{string:navigator.platform,if:["Linux armv7l","Android"],identity:tD.Fg},{string:navigator.userAgent,if:["Android"],identity:tD.Fg},{string:navigator.platform,if:"Linux",identity:"Linux"}],Y=new a,l=class t{constructor(t,e,i,r,s){this.userId=t,this.type=e,this.time=null==i||""===i?new Date().valueOf():i,this.sessionId=r,this.data=s}Si(){var t={name:this.type,time:tb(this.time),data:this.data||{},session_id:this.sessionId};return null!=this.userId&&(t.user_id=this.userId),t}ss(){return{u:this.userId,t:this.type,ts:this.time,s:this.sessionId,d:this.data}}static fromJson(e){return new t(e.user_id,e.name,e.time,e.session_id,e.data)}static Fa(t){return null!=t&&tf(t)&&null!=t.t&&""!==t.t}static jn(e){return new t(e.u,e.t,e.ts,e.s,e.d)}},u=class t{constructor(t,e,i){null==t&&(t=W.it.nt()),(isNaN(i=parseInt(i))||0===i)&&(i=new Date().valueOf()),this.iu=t,this.wh=i,this.Ch=new Date().valueOf(),this.Dh=e}ss(){return{g:this.iu,e:this.Dh,c:this.wh,l:this.Ch}}static jn(e){if(null==e||null==e.g)return null;var i=new t(e.g,e.e,e.c);return i.Ch=e.l,i}},V=new RegExp(/^.+@.+\..+$/),(h=class t{constructor(t,e){this.v=t,this.si=e}getUserId(t){null==t&&W.D.error("getUserId must be supplied with a callback. e.g., braze.getUser().getUserId(function(userId) {console.log('the user id is ' + userId)})"),"function"==typeof t&&t(this.v.getUserId())}addAlias(t,e){return!t$(t,"add alias","the alias",!1)||t.length<=0?(W.D.error("addAlias requires a non-empty alias"),!1):!t$(e,"add alias","the label",!1)||e.length<=0?(W.D.error("addAlias requires a non-empty label"),!1):this.si.Nn(t,e).S}setFirstName(t){return!!t$(t,"set first name","the firstName",!0)&&this.v.nu("first_name",t)}setLastName(t){return!!t$(t,"set last name","the lastName",!0)&&this.v.nu("last_name",t)}setEmail(t){return null===t||"string"==typeof t&&null!=t.toLowerCase().match(V)?this.v.nu("email",t):(W.D.error(`Cannot set email address - "${t}" did not pass RFC-5322 validation.`),!1)}setGender(e){return"string"==typeof e&&(e=e.toLowerCase()),!(null!==e&&!tc(t.Genders,e,`Gender "${e}" is not a valid gender.`,"User.Genders"))&&this.v.nu("gender",e)}setDateOfBirth(t,e,i){return null===t&&null===e&&null===i?this.v.nu("dob",null):(t=parseInt(t),e=parseInt(e),i=parseInt(i),isNaN(t)||isNaN(e)||isNaN(i)||e>12||e<1||i>31||i<1?(W.D.error("Cannot set date of birth - parameters should comprise a valid date e.g. setDateOfBirth(1776, 7, 4);"),!1):this.v.nu("dob",`${t}-${e}-${i}`))}setCountry(t){return!!t$(t,"set country","the country",!0)&&this.v.nu("country",t)}setHomeCity(t){return!!t$(t,"set home city","the homeCity",!0)&&this.v.nu("home_city",t)}setLanguage(t){return!!t$(t,"set language","the language",!0)&&this.v.nu("language",t)}setEmailNotificationSubscriptionType(e){return!!tc(t.NotificationSubscriptionTypes,e,`Email notification setting "${e}" is not a valid subscription type.`,"User.NotificationSubscriptionTypes")&&this.v.nu("email_subscribe",e)}setPushNotificationSubscriptionType(e){return!!tc(t.NotificationSubscriptionTypes,e,`Push notification setting "${e}" is not a valid subscription type.`,"User.NotificationSubscriptionTypes")&&this.v.nu("push_subscribe",e)}setPhoneNumber(e){return!!t$(e,"set phone number","the phoneNumber",!0)&&(null===e||e.match(t.Cn)?this.v.nu("phone",e):(W.D.error(`Cannot set phone number - "${e}" did not pass validation.`),!1))}setLastKnownLocation(t,e,i,r,s){return null==t||null==e?(W.D.error("Cannot set last-known location - latitude and longitude are required."),!1):(t=parseFloat(t),e=parseFloat(e),null!=i&&(i=parseFloat(i)),null!=r&&(r=parseFloat(r)),null!=s&&(s=parseFloat(s)),isNaN(t)||isNaN(e)||null!=i&&isNaN(i)||null!=r&&isNaN(r)||null!=s&&isNaN(s)?(W.D.error("Cannot set last-known location - all supplied parameters must be numeric."),!1):t>90||t<-90||e>180||e<-180?(W.D.error("Cannot set last-known location - latitude and longitude are bounded by \xb190 and \xb1180 respectively."),!1):null!=i&&i<0||null!=s&&s<0?(W.D.error("Cannot set last-known location - accuracy and altitudeAccuracy may not be negative."),!1):this.si.setLastKnownLocation(this.v.getUserId(),t,e,r,i,s).S)}setCustomUserAttribute(t,e){if(!tq(t,"set custom user attribute","the given key"))return!1;var i=typeof e,r=tg(e),s=td(e);if("number"!==i&&"boolean"!==i&&!r&&!s&&null!==e&&!tq(e,`set custom user attribute "${t}"`,"the given value"))return!1;if(r&&(e=tw(e)),s){for(var n=0;n<e.length;n++)if(!tq(e[n],`set custom user attribute "${t}"`,"the element in the given array"))return!1;return this.si.In(W.A.Un,t,e).S}return this.v.setCustomUserAttribute(t,e)}addToCustomAttributeArray(t,e){return!!tq(t,"add to custom user attribute array","the given key")&&!(null!=e&&!tq(e,"add to custom user attribute array","the given value"))&&this.si.In(W.A.En,t,e).S}removeFromCustomAttributeArray(t,e){return!!tq(t,"remove from custom user attribute array","the given key")&&!(null!=e&&!tq(e,"remove from custom user attribute array","the given value"))&&this.si.In(W.A.Fn,t,e).S}incrementCustomUserAttribute(t,e){if(!tq(t,"increment custom user attribute","the given key"))return!1;null==e&&(e=1);var i=parseInt(e);return isNaN(i)||i!==parseFloat(e)?(W.D.error(`Cannot increment custom user attribute because the given incrementValue "${e}" is not an integer.`),!1):this.si.In(W.A.Tn,t,i).S}setCustomLocationAttribute(t,e,i){return!!tq(t,"set custom location attribute","the given key")&&((null!==e||null!==i)&&(e=parseFloat(e),i=parseFloat(i),isNaN(e)||e>90||e<-90||isNaN(i)||i>180||i<-180)?(W.D.error("Received invalid values for latitude and/or longitude. Latitude and longitude are bounded by \xb190 and \xb1180 respectively, or must both be null for removal."),!1):this.si.$n(t,e,i).S)}addToSubscriptionGroup(e){return!t$(e,"add user to subscription group","subscription group ID",!1)||e.length<=0?(W.D.error("addToSubscriptionGroup requires a non-empty subscription group ID"),!1):this.si.Bn(e,t.Ln.SUBSCRIBED).S}removeFromSubscriptionGroup(e){return!t$(e,"remove user from subscription group","subscription group ID",!1)||e.length<=0?(W.D.error("removeFromSubscriptionGroup requires a non-empty subscription group ID"),!1):this.si.Bn(e,t.Ln.UNSUBSCRIBED).S}Zr(t,e,i,r,s){this.v.Zr(t,e,i,r,s),this.si.Rn()}fn(t){this.v.fn(t)}}).Cn=/^[0-9 .\\(\\)\\+\\-]+$/,h.Genders={MALE:"m",FEMALE:"f",OTHER:"o",UNKNOWN:"u",NOT_APPLICABLE:"n",PREFER_NOT_TO_SAY:"p"},h.NotificationSubscriptionTypes={OPTED_IN:"opted_in",SUBSCRIBED:"subscribed",UNSUBSCRIBED:"unsubscribed"},h.Ln={SUBSCRIBED:"subscribed",UNSUBSCRIBED:"unsubscribed"},h.On="user_id",h.lu="custom",h.ee=997,t("ineligibleBrazeActionURLErrorMessage",c=class{constructor(t,e){this.Ma=t,this.Ca=e}ru(t,e){var i=e;null!=e&&e instanceof u&&(i=e.ss()),this.Ma.store(t,i)}ya(t){var e=this.tu(t);null!=e&&(e.Ch=new Date().valueOf(),this.ru(t,e))}tu(t){return u.jn(this.Ma.lr(t))}Hh(t){this.Ma.remove(t)}bo(t){if(null==t||0===t.length)return!1;td(t)||(t=[t]);var e=this.Ca.lr(tj.q.Ta);null!=e&&td(e)||(e=[]);for(var i=0;i<t.length;i++)e.push(t[i].ss());return this.Ca.store(tj.q.Ta,e)}Nh(t){return null!=t&&this.bo([t])}Ua(){var t=this.Ca.lr(tj.q.Ta);this.Ca.remove(tj.q.Ta),null==t&&(t=[]);var e=[],i=!1,r=null;if(td(t))for(var s=0;s<t.length;s++)l.Fa(t[s])?e.push(l.jn(t[s])):r=s;else i=!0;if(i||null!=r){var n="Stored events could not be deserialized as Events";i&&(n+=", was "+Object.prototype.toString.call(t)+" not an array"),null!=r&&(n+=", value at index "+r+" does not look like an event"),n+=", serialized values were of type "+typeof t+": "+JSON.stringify(t),e.push(new l(null,W.A.qs,new Date().valueOf(),null,{e:n}))}return e}B(t,e){return!!tc(tj.q,t,"StorageManager cannot store object.","STORAGE_KEYS.OBJECTS")&&this.Ca.store(t,e)}I(t){return!!tc(tj.q,t,"StorageManager cannot retrieve object.","STORAGE_KEYS.OBJECTS")&&this.Ca.lr(t)}Xs(t){return!!tc(tj.q,t,"StorageManager cannot remove object.","STORAGE_KEYS.OBJECTS")&&(this.Ca.remove(t),!0)}clearData(){for(var t=tp(tj.eu),e=tp(tj.q),i=0;i<t.length;i++){var r=t[i];this.Ma.remove(tj.eu[r])}for(var s=0;s<e.length;s++){var n=e[s];this.Ca.remove(tj.q[n])}}La(t){return t||tj.q.Ka}za(t){var e=this.Ca.lr(tj.q.Ia);null==e&&(e={});var i=this.La(t[h.On]);for(var r in t)r===h.On||null!=e[i]&&null!=e[i][r]||this.mu(t[h.On],r,t[r])}mu(t,e,i){var r=this.Ca.lr(tj.q.Ia);null==r&&(r={});var s=this.La(t),n=r[s];if(null==n&&(n={},null!=t&&(n[h.On]=t)),e===h.lu)for(var o in null==n[e]&&(n[e]={}),i)n[e][o]=i[o];else n[e]=i;return r[s]=n,this.Ca.store(tj.q.Ia,r)}Pa(){var t=this.Ca.lr(tj.q.Ia);this.Ca.remove(tj.q.Ia);var e=[];for(var i in t)null!=t[i]&&e.push(t[i]);return e}ou(t){var e=this.Ca.lr(tj.q.Ia);if(null!=e){var i=this.La(null),r=e[i];null!=r&&(e[i]=void 0,this.Ca.store(tj.q.Ia,e),r[h.On]=t,this.za(r))}var s=this.tu(tj.eu.Sh),n=null;null!=s&&(n=s.iu);var o=this.Ua();if(null!=o)for(var a=0;a<o.length;a++){var l=o[a];null==l.userId&&l.sessionId==n&&(l.userId=t),this.Nh(l)}}xa(){return this.Ca.Ja}}),c._a=class{constructor(t){this._r=t,this.Ja=Y.ka()?3:10}Va(t){return t+"."+this._r}store(t,e){try{return localStorage.setItem(this.Va(t),JSON.stringify({v:e})),!0}catch(t){return W.D.info("Storage failure: "+t.message),!1}}lr(t){try{var e=JSON.parse(localStorage.getItem(this.Va(t)));return null==e?null:e.v}catch(t){return W.D.info("Storage retrieval failure: "+t.message),null}}remove(t){try{localStorage.removeItem(this.Va(t))}catch(t){return W.D.info("Storage removal failure: "+t.message),!1}}},c.ne=class{constructor(t,e){this._r=t,this.Qa=this.Ha(),this.Wa=576e3,this.Xa=!!e}Va(t){return null!=this._r?t+"."+this._r:t}Ha(){for(var t=0,e=document.location.hostname,i=e.split("."),r="ab._gd";t<i.length-1&&-1===document.cookie.indexOf(r+"="+r);)t++,e="."+i.slice(-1-t).join("."),document.cookie=r+"="+r+";domain="+e+";";return document.cookie=r+"=;expires="+new Date(0).toGMTString()+";domain="+e+";",e}ie(){var t=new Date;return t.setTime(t.getTime()+60*this.Wa*1e3),t.getFullYear()}Za(){for(var t=th(tj.eu),e=document.cookie.split(";"),i=0;i<e.length;i++){for(var r=e[i];" "===r.charAt(0);)r=r.substring(1);for(var s=!1,n=0;n<t.length;n++)if(0===r.indexOf(t[n])){s=!0;break}if(s){var o=r.split("=")[0];-1===o.indexOf("."+this._r)&&this.$a(o)}}}store(t,e){this.Za();var i,r=new Date;r.setTime(r.getTime()+60*this.Wa*1e3);var s="expires="+r.toUTCString(),n="domain="+this.Qa;i=this.Xa?e:encodeURIComponent(JSON.stringify(e));var o=this.Va(t)+"="+i+";"+s+";"+n+";path=/";return o.length>=4093?(W.D.info("Storage failure: string is "+o.length+" chars which is too large to store as a cookie."),!1):(document.cookie=o,!0)}lr(t){for(var e=[],i=this.Va(t)+"=",r=document.cookie.split(";"),s=0;s<r.length;s++){for(var n=r[s];" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(i))try{var o=void 0;o=this.Xa?n.substring(i.length,n.length):JSON.parse(decodeURIComponent(n.substring(i.length,n.length))),e.push(o)}catch(e){return W.D.info("Storage retrieval failure: "+e.message),this.remove(t),null}}return e.length>0?e[e.length-1]:null}remove(t){this.$a(this.Va(t))}$a(t){var e=t+"=;expires="+new Date(0).toGMTString();document.cookie=e,document.cookie=e+";path=/";var i=e+";domain="+this.Qa;document.cookie=i,document.cookie=i+";path=/"}},c.Oa=class{constructor(){this.El={},this.Sl=5242880,this.Ja=3}store(t,e){var i=this._l(e);return i>this.Sl?(W.D.info("Storage failure: object is ≈"+i+" bytes which is greater than the max of "+this.Sl),!1):(this.El[t]={value:e},!0)}_l(t){for(var e=[],i=[t],r=0;i.length;){var s=i.pop();if("boolean"==typeof s)r+=4;else if("string"==typeof s)r+=2*s.length;else if("number"==typeof s)r+=8;else if("object"==typeof s&&-1===e.indexOf(s))for(var n in e.push(s),s)i.push(s[n])}return r}lr(t){var e=this.El[t];return null==e?null:e.value}remove(t){this.El[t]=null}},c.wa=class{constructor(t,e,i){this.Tl=[],e&&this.Tl.push(new c.ne(t)),i&&this.Tl.push(new c._a(t)),this.Tl.push(new c.Oa(t))}store(t,e){for(var i=!0,r=0;r<this.Tl.length;r++)i=this.Tl[r].store(t,e)&&i;return i}lr(t){for(var e=0;e<this.Tl.length;e++){var i=this.Tl[e].lr(t);if(null!=i)return i}return null}remove(t){for(var e=0;e<this.Tl.length;e++)this.Tl[e].remove(t)}},d=class{constructor(t,e,i){this.h=t,this.xn=e||!1,this.qn=i,this.Gn=new r,this.Hn=0,this.Jn=1}Kn(){return this.xn}Mn(){return this.h.I(tj.q.Qn)}setSdkAuthenticationSignature(t){var e=this.Mn();this.h.B(tj.q.Qn,t);var i=W.xt.Ft;new W.qt(i,W.D).setItem(i.$t.Vn,this.Jn,t),e!==t&&this.Qs()}Wn(){this.h.Xs(tj.q.Qn);var t=W.xt.Ft;new W.qt(t,W.D).br(t.$t.Vn,this.Jn)}subscribeToSdkAuthenticationFailures(t){return this.qn.ut(t)}Xn(t){this.qn.St(t)}Yn(){this.Gn.removeAllSubscriptions()}Zn(){this.Hn+=1}au(){return this.Hn}Qs(){this.Hn=0}},t("y",g=class{constructor(){}Rs(){}changeUser(t){}clearData(){}}),f=class{constructor(t){this.id=t}Si(){var t={};return null!=this[tF.BROWSER]&&(t.browser=this[tF.BROWSER]),null!=this[tF.BROWSER_VERSION]&&(t.browser_version=this[tF.BROWSER_VERSION]),null!=this[tF.OS]&&(t.os_version=this[tF.OS]),null!=this[tF.RESOLUTION]&&(t.resolution=this[tF.RESOLUTION]),null!=this[tF.LANGUAGE]&&(t.locale=this[tF.LANGUAGE]),null!=this[tF.TIME_ZONE]&&(t.time_zone=this[tF.TIME_ZONE]),null!=this[tF.USER_AGENT]&&(t.user_agent=this[tF.USER_AGENT]),t}},v=class{constructor(t,e){this.h=t,null==e&&(e=th(tF)),this.xo=e}te(){var t=this.h.tu(tj.eu.Jo);null==t&&(t=new u(W.it.nt()),this.h.ru(tj.eu.Jo,t));for(var e=new f(t.iu),i=0;i<this.xo.length;i++){var r=this.xo[i];switch(r){case tF.BROWSER:e[r]=Y.browser;break;case tF.BROWSER_VERSION:e[r]=Y.version;break;case tF.OS:e[r]=this.qo();break;case tF.RESOLUTION:e[r]=screen.width+"x"+screen.height;break;case tF.LANGUAGE:e[r]=Y.language;break;case tF.TIME_ZONE:e[r]=this.Qo(new Date);break;case tF.USER_AGENT:e[r]=Y.userAgent}}return e}qo(){if(Y.Xo())return Y.Xo();var t=this.h.I(tj.q.Yo);return t&&t.os_version?t.os_version:Y.Zo()}Qo(t){if("undefined"!=typeof Intl&&"function"==typeof Intl.DateTimeFormat)try{if("function"==typeof Intl.DateTimeFormat().resolvedOptions){var e=Intl.DateTimeFormat().resolvedOptions().timeZone;if(null!=e&&""!==e)return e}}catch(e){W.D.info("Intl.DateTimeFormat threw an error, cannot detect user's time zone:"+e.message),t=""}if(!t)return t;var i=t.getTimezoneOffset();return this.sa(i)}sa(t){var e=parseInt(t/60),i=parseInt(t%60),r="GMT";return 0!==t&&(r+=(t<0?"+":"-")+("00"+Math.abs(e)).slice(-2)+":"+("00"+Math.abs(i)).slice(-2)),r}},p=class{constructor(t,e,i,r,s,n,o,a,l,u,h){this.Ur=t,this.h=e,this.Ho=i,this.v=r,this.j=s,this.gt=n,this._r=o,this.Wo=a,this.Uo=l,this.Ko=u,this.oa=h,this.ua=["npm"]}Ps(t,e){var i=this.Ur.te(),r=i.Si();tm(this.h.I(tj.q.Yo),r)||(t.device=r),t.api_key=this._r,t.time=tb(new Date().valueOf(),!0);var s=this.h.I(tj.q.ha)||[],n=this.h.I(tj.q.ca)||"";if(this.ua.length>0&&(!tm(s,this.ua)||n!==this.j.la())&&(t.sdk_metadata=this.ua),t.sdk_version=this.Uo,this.Ko&&(t.sdk_flavor=this.Ko),t.app_version=this.oa,t.device_id=i.id,e){var o=this.v.getUserId();null!=o&&(t.user_id=o)}return t}Os(t,e,i){var r=e.auth_error,s=e.error;if(!r&&!s)return!0;if(r){this.Ho.Zn();var n,o={errorCode:r.error_code};for(var a of i)td(a)&&"X-Braze-Auth-Signature"===a[0]&&(o.signature=a[1]);t.respond_with&&t.respond_with.user_id?o.userId=t.respond_with.user_id:t.user_id&&(o.userId=t.user_id);var l=r.reason;return l?(o.reason=l,n=`due to ${l}`):n=`with error code ${r.error_code}.`,this.Ho.Kn()||(n+=' Please use the "enableSdkAuthentication" initialization option to enable authentication.'),W.D.error(`SDK Authentication failed ${n}`),this.fa(t.events,t.attributes),this.Ho.Xn(o),!1}if(s){var u=s;switch(u){case tG.ma:var h="Received successful response with empty body.";return tr.G(W.A.qs,{e:h}),W.D.info(h),!1;case tG.pa:var c="Received successful response with invalid JSON";return tr.G(W.A.qs,{e:c+": "+e.response}),W.D.info(c),!1;case tG.Ra:u=`The API key "${t.api_key}" is invalid for the baseUrl ${this.Wo}`;break;case tG.ba:u="Sorry, we are not currently accepting your requests. If you think this is in error, please contact us.";break;case tG.ga:u="No device identifier. Please contact support@braze.com"}W.D.error("Backend error: "+u)}return!1}qa(t,e,i,r){return!!(t&&0!==t.length||e&&0!==e.length||i||r)}Aa(t,e,i,r){var s,n,o,a,l=[],u=t=>t||"",h=u(this.v.getUserId()),c=this.wi(t,e);if(i.length>0){var d=[];for(var g of i){if(s=g.Si(),this.Ho.Kn()){if(h&&!s.user_id){a||((a={}).events=[]),a.events.push(s);continue}if(u(s.user_id)!==h){n||(n=[]),n.push(s);continue}}d.push(s)}d.length>0&&(c.events=d)}if(r.length>0){var f=[];for(var v of r)this.Ho.Kn()&&u(v.user_id)!==h?(o||(o=[]),o.push(v)):f.push(v);f.length>0&&(c.attributes=f)}if(this.fa(n,o),c=this.Ps(c,!0),a){var p={requestData:a=this.Ps(a,!1),headers:this.Bs(a)};l.push(p)}if(c&&!this.qa(c.events,c.attributes,t,e))return a?l:null;var m={requestData:c,headers:this.Bs(c)};return l.push(m),l}fa(t,e){if(t){var i=[];for(var r of t){var s=l.fromJson(r);s.time=1e3*s.time,i.push(s)}this.h.bo(i)}if(e)for(var n of e)this.h.za(n)}Vs(t,e){var i="HTTP error ";null!=t&&(i+=t+" "),i+=e,W.D.error(i)}Fr(t){return tr.G(W.A.Ba,{n:t})}wi(t,e,i){var r={};t&&(r.feed=!0),e&&(r.triggers=!0);var s=null!=i?i:this.v.getUserId();return s&&(r.user_id=s),r.config={config_time:this.gt.Zs()},{respond_with:r}}Bs(t,e,i,r){var s=[["X-Braze-Api-Key",this._r]],n=!1;if(null!=t.respond_with&&t.respond_with.triggers&&(s.push(["X-Braze-TriggersRequest","true"]),n=!0),null!=t.respond_with&&t.respond_with.feed&&(s.push(["X-Braze-FeedRequest","true"]),n=!0),e){s.push(["X-Braze-ContentCardsRequest","true"]);var o=this.h.I(tj.q.As);o&&r||(o=0,this.h.B(tj.q.As,o)),s.push(["BRAZE-SYNC-RETRY-COUNT",o.toString()]),n=!0}if(i&&(s.push(["X-Braze-FeatureFlagsRequest","true"]),n=!0),n&&s.push(["X-Braze-DataRequest","true"]),this.Ho.Kn()){var a=this.Ho.Mn();null!=a&&s.push(["X-Braze-Auth-Signature",a])}return s}Gs(t,e){var i=t.device;i&&i.os_version instanceof Promise?i.os_version.then(i=>{t.device.os_version=i,e()}):e()}Qs(){this.Ho.Qs()}Ks(){return this.Wo}addSdkMetadata(t){for(var e of t)-1===this.ua.indexOf(e)&&this.ua.push(e)}},Z=tJ,t("t",m=class{constructor(t,e){this.S=!!t,this.ve=e||[]}V(t){this.S=this.S&&t.S,this.ve.push(...t.ve)}}),K=tW,b=class{constructor(t,e,i,s,n,o,a,l,u,h){this._r=t,this.Wo=e,this.kl=0,this.yl=a.xa(),this.jl=null,this.j=i,this.Ur=s,this.v=n,this.gt=o,this.h=a,this.Ho=u,this.vt=h,this.$l=l,this.Al=new r,this.ql=50}Fl(t,e){return!t&&!e&&this.Ho.au()>=this.ql}Dl(t){var e=this.j.jh();if(t.length>0){var i=this.v.getUserId();for(var r of t){var s=!r.userId&&!i||r.userId===i;r.type===W.A._h&&s&&(e=!0)}}return e}Ll(t,e,i,r,s,n,o){var a=this;null==i&&(i=!0),i&&this.Pl();var l=this.h.Ua(),u=this.h.Pa(),h=!1,c=(t,e)=>{var o=!1;Z.Hs({url:this.Wo+"/data/",data:t,headers:e,S:i=>{null!=t.respond_with&&t.respond_with.triggers&&(this.kl=Math.max(this.kl-1,0)),this.vt.Os(t,i,e)?(this.Ho.Qs(),this.gt.al(i),null!=t.respond_with&&t.respond_with.user_id!=this.v.getUserId()||(null!=t.device&&this.h.B(tj.q.Yo,t.device),null!=t.sdk_metadata&&(this.h.B(tj.q.ha,t.sdk_metadata),this.h.B(tj.q.ca,this.j.la())),this.$l(i),"function"==typeof r&&r())):i.auth_error&&(o=!0)},error:()=>{null!=t.respond_with&&t.respond_with.triggers&&(this.kl=Math.max(this.kl-1,0)),this.vt.fa(t.events,t.attributes),"function"==typeof s&&s()},Ue:t=>{if("function"==typeof n&&n(t),i&&!h){if(t&&!o)this.Rl();else{var e=this.jl;(null==e||e<1e3*this.yl)&&(e=1e3*this.yl),this.Rl(Math.min(3e5,tz(1e3*this.yl,3*e)))}h=!0}}})},d=this.Dl(l),g=e||d;if(this.Fl(o,d))return void W.D.info("Declining to flush data due to 50 consecutive authentication failures");if(i&&!this.vt.qa(l,u,t,g))return this.Rl(),void("function"==typeof n&&n(!0));var f=this.vt.Aa(t,g,l,u);g&&this.kl++;var v=!1;if(f){var p=function(t){a.vt.Gs(t.requestData,()=>c(t.requestData,t.headers)),v=!0};for(var m of f)p(m)}this.Ho.Kn()&&i&&!v?this.Rl():d&&(W.D.info("Invoking new session subscriptions"),this.Al.St())}Ml(){return this.kl>0}Rl(t){this.Il||(null==t&&(t=1e3*this.yl),this.Pl(),this.Nl=setTimeout(()=>{if(document.hidden){var t="visibilitychange",e=()=>{document.hidden||(document.removeEventListener(t,e,!1),this.Ll())};document.addEventListener(t,e,!1)}else this.Ll()},t),this.jl=t)}Pl(){null!=this.Nl&&(clearTimeout(this.Nl),this.Nl=null)}initialize(){this.Il=!1,this.Rl()}destroy(){this.Al.removeAllSubscriptions(),this.Ho.Yn(),this.Pl(),this.Il=!0,this.Ll(null,null,!1),this.Nl=null}cr(t){return this.Al.ut(t)}openSession(){var t=this.j.la()!==this.j.mo();t&&(this.h.ya(tj.eu.Jo),this.h.ya(tj.eu.su)),this.Ll(null,!1,null,null,null),this.Rn(),t&&e("0mp3yz").then(t=>{if(!this.Il){var e=t.default.aa();if(null!=e&&(K.isPushPermissionGranted()||K.isPushBlocked())){var i=()=>{e.Jr()?W.D.info("Push token maintenance is disabled, not refreshing token for backend."):e.subscribe()},r=W.xt.Ft;new W.qt(r,W.D).hr(r.$t.cu,(t,e)=>{e&&i()},()=>{var t=this.h.I(tj.q.Sn);(null==t||t)&&i()})}}})}changeUser(t,e,i){var r=this.v.getUserId();if(r!==t){this.j.Fh(),null!=r&&this.Ll(null,!1,null,null,null),this.v.uu(t),i?this.Ho.setSdkAuthenticationSignature(i):this.Ho.Wn();for(var s=0;s<e.length;s++)e[s].changeUser(null==r);null!=r&&this.h.Xs(tj.q.P),this.h.Xs(tj.q.Yo),this.openSession(),W.D.info('Changed user to "'+t+'".')}else{var n="Doing nothing.";i&&this.Ho.Mn()!==i&&(this.Ho.setSdkAuthenticationSignature(i),n="Updated SDK authentication signature"),W.D.info(`Current user is already ${t}. ${n}`)}}requestImmediateDataFlush(t){this.Pl(),this.j.mo(),this.Ll(null,null,null,null,()=>{W.D.error("Failed to flush data, request will be retried automatically.")},t,!0)}requestFeedRefresh(){this.j.mo(),this.Ll(!0)}zr(t,e){this.j.mo(),W.D.info("Requesting explicit trigger refresh."),this.Ll(null,!0,null,t,e)}Nn(t,e){var i=W.A.Ol,r=tr.G(i,{a:t,l:e});return r&&W.D.info(`Logged alias ${t} with label ${e}`),r}In(t,e,i){if(this.gt.hu(e))return W.D.info(`Custom Attribute "${e}" is blocklisted, ignoring.`),new m;var r=tr.G(t,{key:e,value:i});return r&&W.D.info(`Logged custom attribute: ${e} with value: ${i}`),r}setLastKnownLocation(t,e,i,r,s,n){var o={latitude:e,longitude:i};null!=r&&(o.altitude=r),null!=s&&(o.ll_accuracy=s),null!=n&&(o.alt_accuracy=n);var a=tr.G(W.A.Ul,o,t);return a&&W.D.info(`Set user last known location as ${JSON.stringify(o,null,2)}`),a}kr(t,e){var i=this.j.mo();return new l(this.v.getUserId(),W.A.xl,t,i,{cid:e})}Rn(){var t=W.xt.Ft;new W.qt(t,W.D).setItem(t.$t.Kl,1,{baseUrl:this.Wo,data:{api_key:this._r,device_id:this.Ur.te().id},userId:this.v.getUserId(),sdkAuthEnabled:this.Ho.Kn()})}wr(t){for(var e of t)if(e.api_key===this._r)this.vt.fa(e.events,e.attributes);else{var i=W.xt.Ft;new W.qt(i,W.D).setItem(i.$t.$r,W.it.nt(),e)}}$n(t,e,i){var r,s;return this.gt.hu(t)?(W.D.info(`Custom Attribute "${t}" is blocklisted, ignoring.`),new m):(null===e&&null===i?(r=W.A.Wl,s={key:t}):(r=W.A.Bl,s={key:t,latitude:e,longitude:i}),tr.G(r,s))}Bn(t,e){return tr.G(W.A.Gl,{group_id:t,status:e})}},y=class t{constructor(t,e,i,r,s,n,o,a){this.ol=t||0,this.bl=e||[],this.dl=i||[],this.vl=r||[],this.Cl=s,null!=s&&""!==s||(this.Cl=null),this.gl=n||null,this.ml=o||{},this.cl=a||{}}ss(){return{s:"4.6.3",l:this.ol,e:this.bl,a:this.dl,p:this.vl,m:this.Cl,v:this.gl,c:this.ml,f:this.cl}}static jn(e){var i=e.l;return"4.6.3"!==e.s&&(i=0),new t(i,e.e,e.a,e.p,e.m,e.v,e.c,e.f)}},w=class{constructor(t){this.h=t,this.tl=new r,this.el=new r,this.sl=new r,this.il=null}rl(){if(null==this.il){var t=this.h.I(tj.q.hl);this.il=null!=t?y.jn(t):new y}return this.il}Zs(){return this.rl().ol}al(t){if(null!=t&&null!=t.config){var e=t.config;if(e.time>this.rl().ol){var i=new y(e.time,e.events_blacklist,e.attributes_blacklist,e.purchases_blacklist,e.messaging_session_timeout,e.vapid_public_key,e.content_cards,e.feature_flags),r=!1;null!=i.gl&&this.vn()!==i.gl&&(r=!0);var s=!1;null!=i.ml.enabled&&this.Ys()!==i.ml.enabled&&(s=!0);var n=!1;null!=i.cl.enabled&&this._e()!==i.cl.enabled&&(n=!0),this.il=i,this.h.B(tj.q.hl,i.ss()),r&&this.tl.St(),s&&this.el.St(),n&&this.sl.St()}}}kn(t){var e=this.tl.ut(t);return this.fl&&this.tl.removeSubscription(this.fl),this.fl=e,e}Ms(t){return this.el.ut(t)}qe(t){return this.sl.ut(t)}ge(t){return -1!==this.rl().bl.indexOf(t)}hu(t){return -1!==this.rl().dl.indexOf(t)}Dr(t){return -1!==this.rl().vl.indexOf(t)}wl(){return this.rl().Cl}vn(){return this.rl().gl}Ys(){return this.rl().ml.enabled||!1}_e(){return this.rl().cl.enabled&&null==this.Be()?(tr.G(W.A.qs,{e:"Missing feature flag refresh_rate_limit."}),!1):this.rl().cl.enabled||!1}Be(){return this.rl().cl.refresh_rate_limit}},S=class{constructor(t,e,i,r){this.h=t,this.v=e,this.gt=i,this.dh=1e3,isNaN(r=parseFloat(r))&&(r=1800),r<this.dh/1e3&&(W.D.info("Specified session timeout of "+r+"s is too small, using the minimum session timeout of "+this.dh/1e3+"s instead."),r=this.dh/1e3),this.fh=r}ph(t,e){return new l(this.v.getUserId(),W.A.gh,t,e.iu,{d:tb(t-e.wh)})}la(){var t=this.h.tu(tj.eu.Sh);return null==t?null:t.iu}jh(){var t=new Date().valueOf(),e=this.gt.wl(),i=this.h.I(tj.q.bh);if(null!=i&&null==e)return!1;var r=null==i||t-i>1e3*e;return r&&this.h.B(tj.q.bh,t),r}xh(t,e){return null==e||!(t-e.wh<this.dh)&&e.Dh<t}mo(){var t=new Date().valueOf(),e=t+1e3*this.fh,i=this.h.tu(tj.eu.Sh);if(this.xh(t,i)){var r="Generating session start event with time "+t;if(null!=i){var s=i.Ch;s-i.wh<this.dh&&(s=i.wh+this.Gh),this.h.Nh(this.ph(s,i)),r+=" (old session ended "+s+")"}r+=". Will expire "+e.valueOf(),W.D.info(r);var n=new u(W.it.nt(),e);return this.h.Nh(new l(this.v.getUserId(),W.A._h,t,n.iu)),this.h.ru(tj.eu.Sh,n),null==this.h.I(tj.q.bh)&&this.h.B(tj.q.bh,t),n.iu}return i.Ch=t,i.Dh=e,this.h.ru(tj.eu.Sh,i),i.iu}Fh(){var t=this.h.tu(tj.eu.Sh);null!=t&&(this.h.Hh(tj.eu.Sh),this.h.Nh(this.ph(new Date().valueOf(),t)))}},X=tY,_=class t{constructor(t){this.triggerId=t,this.extras={},this.isControl=!0}static fromJson(e){return new t(e.trigger_id)}},Q={vu:null,eo:tV},I=class t{constructor(e,i,s,n,o,a,l,u,h,c,d,g,f,v,p,m,b,y,w,S,_,I,A,D,T,N,O,k,E){this.message=e,this.messageAlignment=i||t.TextAlignment.CENTER,this.duration=c||5e3,this.slideFrom=s||t.SlideFrom.BOTTOM,this.extras=n||{},this.triggerId=o,this.clickAction=a||t.ClickAction.NONE,this.uri=l,this.openTarget=u||t.OpenTarget.NONE,this.dismissType=h||t.DismissType.AUTO_DISMISS,this.icon=d,this.imageUrl=g,this.imageStyle=f||t.ImageStyle.TOP,this.iconColor=v||t.Ji.Hi,this.iconBackgroundColor=p||t.Ji.Ci,this.backgroundColor=m||t.Ji.Hi,this.textColor=b||t.Ji.Li,this.closeButtonColor=y||t.Ji.Oi,this.animateIn=w,null==this.animateIn&&(this.animateIn=!0),this.animateOut=S,null==this.animateOut&&(this.animateOut=!0),this.header=_,this.headerAlignment=I||t.TextAlignment.CENTER,this.headerTextColor=A||t.Ji.Li,this.frameColor=D||t.Ji.Ri,this.buttons=T||[],this.cropType=N||t.CropType.FIT_CENTER,this.orientation=O,this.htmlId=k,this.css=E,this.isControl=!1,this.Pi=!1,this.nl=!1,this.Ui=!1,this.lt=new r,this.Wi=new r}subscribeToClickedEvent(t){return this.lt.ut(t)}subscribeToDismissedEvent(t){return this.Wi.ut(t)}removeSubscription(t){this.lt.removeSubscription(t),this.Wi.removeSubscription(t)}removeAllSubscriptions(){this.lt.removeAllSubscriptions(),this.Wi.removeAllSubscriptions()}closeMessage(){this.on(this.mn)}Ie(){return!0}ll(){return this.Ie()}an(){return null!=this.htmlId&&this.htmlId.length>4}sn(){return this.an()&&null!=this.css&&this.css.length>0}rn(){if(this.an()&&this.sn())return this.htmlId+"-css"}R(){return!this.Pi&&(this.Pi=!0,!0)}Cr(){return this.Pi}k(){return!this.nl&&(this.nl=!0,this.lt.St(),!0)}J(){return!this.Ui&&(this.Ui=!0,this.Wi.St(),!0)}Ki(e){if(e&&e.parentNode){var i=e.closest(".ab-iam-root");if(null==i&&(i=e),this.Ie()&&null!=i.parentNode){var r=i.parentNode.classList;r&&r.contains(t.Yi)&&r.remove(t.Yi),document.body.removeEventListener("touchmove",t.Xi)}i.className=i.className.replace(t.Vi,t.Qi)}return this.animateOut}on(e,i){if(null!=e){this.mn=null;var r,s=!1;(r=-1===e.className.indexOf("ab-in-app-message")?e.getElementsByClassName("ab-in-app-message")[0]:e)&&(s=this.Ki(r));var n=document.body;if(null!=n)var o=n.scrollTop;var a=()=>{if(e&&e.parentNode){var t=e.closest(".ab-iam-root");null==t&&(t=e),t.parentNode&&t.parentNode.removeChild(t)}if(null!=this.rn()){var r=document.getElementById(this.rn());r&&r.parentNode&&r.parentNode.removeChild(r)}null!=n&&"Safari"===Y.browser&&(n.scrollTop=o),i?i():this.J()};s?setTimeout(a,t.Zi):a(),this.Le&&this.Le.focus()}}Oe(){return document.createTextNode(this.message)}Je(t){var e="";this.message||this.header||!this.Ie()||(e="Modal Image"),t.setAttribute("alt",e)}static Xi(e){e.targetTouches&&e.targetTouches.length>1||e.target.classList&&e.target.classList.contains("ab-message-text")&&e.target.scrollHeight>e.target.clientHeight||document.querySelector(`.${t.Yi}`)&&e.preventDefault()}th(e){this.Ie()&&null!=e.parentNode&&this.orientation!==t.Orientation.LANDSCAPE&&(null!=e.parentNode.classList&&e.parentNode.classList.add(t.Yi),document.body.addEventListener("touchmove",t.Xi,!!tK()&&{passive:!1})),e.className+=" "+t.Vi}static sh(t){if(t.keyCode===t4.ih&&!ti.nn(eo.eh)&&document.querySelectorAll(".ab-modal-interactions").length>0){for(var e=document.getElementsByClassName("ab-html-message"),i=!1,r=0;r<e.length;r++){var s=e[r].contentWindow.document.getElementsByClassName("ab-programmatic-close-button")[0];null!=s&&(t1(s),i=!0)}if(!i){var n=document.querySelectorAll(".ab-modal-interactions > .ab-close-button")[0];null!=n&&t1(n)}}}hh(){this.nh||ti.nn(eo.eh)||(document.addEventListener("keydown",t.sh,!1),ti.rh(()=>{document.removeEventListener("keydown",t.sh)}),this.nh=!0)}},I.Ji={Li:4281545523,Hi:4294967295,Ci:4278219733,oh:4293914607,lh:4283782485,Ri:3224580915,Oi:4288387995},I.Ge={Eh:"hd",Ee:"ias",uh:"of",Th:"do",Gi:"umt",$i:"tf",ah:"te"},I.SlideFrom={TOP:"TOP",BOTTOM:"BOTTOM"},I.ClickAction={NEWS_FEED:"NEWS_FEED",URI:"URI",NONE:"NONE"},I.DismissType={AUTO_DISMISS:"AUTO_DISMISS",MANUAL:"SWIPE"},I.OpenTarget={NONE:"NONE",BLANK:"BLANK"},I.ImageStyle={TOP:"TOP",GRAPHIC:"GRAPHIC"},I.Orientation={PORTRAIT:"PORTRAIT",LANDSCAPE:"LANDSCAPE"},I.TextAlignment={START:"START",CENTER:"CENTER",END:"END"},I.CropType={CENTER_CROP:"CENTER_CROP",FIT_CENTER:"FIT_CENTER"},I.es={mh:"SLIDEUP",Ih:"MODAL",Ye:"MODAL_STYLED",Tr:"FULL",ul:"WEB_HTML",cn:"HTML"},I.Zi=500,I.Ah=200,I.Vi="ab-show",I.Qi="ab-hide",I.Yi="ab-pause-scrolling",(A=class extends I{constructor(t,e,i,r,s,n,o,a,l,u,h){super(t,null,null,e,i,null,null,null,r=r||I.DismissType.MANUAL,s,null,null,null,null,null,null,null,null,n,o,null,null,null,a,void 0,void 0,void 0,l,u),this.messageFields=h}ll(){return!1}k(t){if(this.un===I.es.ul){if(this.nl)return!1;this.nl=!0}return this.lt.St(t),!0}}).es=I.es.ul,(D=class t{constructor(e,i,s,n,o,a,l){this.text=e||"",this.backgroundColor=i||I.Ji.Ci,this.textColor=s||I.Ji.Hi,this.borderColor=n||this.backgroundColor,this.clickAction=o||I.ClickAction.NONE,this.uri=a,null==l&&(l=t.Mi),this.id=l,this.nl=!1,this.lt=new r}subscribeToClickedEvent(t){return this.lt.ut(t)}removeSubscription(t){this.lt.removeSubscription(t)}removeAllSubscriptions(){this.lt.removeAllSubscriptions()}k(){return!this.nl&&(this.nl=!0,this.lt.St(),!0)}static fromJson(e){return new t(e.text,e.bg_color,e.text_color,e.border_color,e.click_action,e.uri,e.id)}}).Mi=-1,(T=class extends I{constructor(t,e,i,r,s,n,o,a,l,u,h,c,d,g,f,v,p,m,b,y,w,S,_,A,D,T,N,O){super(t,e,null,i,r,s,n,o,a=a||I.DismissType.MANUAL,l,u,h,c,d,g,f,v,p,m,b,y,w,S,_,A,D=D||I.CropType.CENTER_CROP,T=T||I.Orientation.PORTRAIT,N,O)}get He(){return I.TextAlignment.CENTER}}).es=I.es.Tr,(N=class extends I{constructor(t,e,i,r,s,n,o,a,l,u,h,c,d,g,f,v,p,m,b,y,w,S,_,A,D,T,N){super(t,e,null,i,r,s,n,o,a=a||I.DismissType.MANUAL,l,u,h,c,d,g,f,v,p,m,b,y,w,S,_,A,D=D||I.CropType.FIT_CENTER,void 0,T,N)}get He(){return I.TextAlignment.CENTER}}).es=I.es.Ih,(O=class extends I{constructor(t,e,i,r,s,n,o,a,l,u,h,c,d,g,f,v,p,m,b,y,w){super(t,e=e||I.TextAlignment.START,i,r,s,n,o,a,l,u,h,c,null,d,g,f=f||I.Ji.oh,v=v||I.Ji.lh,p,m,b,void 0,void 0,void 0,void 0,void 0,void 0,void 0,y,w)}Ie(){return!1}get He(){return I.TextAlignment.START}Oe(){var t=document.createElement("span");return t.appendChild(document.createTextNode(this.message)),t}th(t){var e=t.getElementsByClassName("ab-in-app-message")[0];Q.eo(e,!0,!0)||(this.slideFrom===I.SlideFrom.TOP?e.style.top="0px":e.style.bottom="0px"),super.th(t)}}).es=I.es.mh,k=class t{constructor(t){this.Jl=t}Hl(t){return null==this.Jl||this.Jl===t[0]}static fromJson(e){return new t(e?e.event_name:null)}ss(){return this.Jl}},(E=class t{constructor(e,i,r,s){this.Xl=e,this.Vl=i,this.comparator=r,this.Yl=s,this.Vl===t.yh.Zl&&this.comparator!==t.Rh.Mh&&this.comparator!==t.Rh.Lh&&this.comparator!==t.Rh.Oh&&this.comparator!==t.Rh.Uh&&(this.Yl=ty(this.Yl))}Hl(e){var i=null;switch(null!=e&&(i=e[this.Xl]),this.comparator){case t.Rh.Qh:return null!=i&&i.valueOf()===this.Yl.valueOf();case t.Rh.Xh:return null==i||i.valueOf()!==this.Yl.valueOf();case t.Rh.Bh:return typeof i==typeof this.Yl&&i>this.Yl;case t.Rh.Mh:return this.Vl===t.yh.Zl?null!=i&&tg(i)&&t_(i)<=this.Yl:typeof i==typeof this.Yl&&i>=this.Yl;case t.Rh.kh:return typeof i==typeof this.Yl&&i<this.Yl;case t.Rh.Lh:return this.Vl===t.yh.Zl?null!=i&&tg(i)&&t_(i)>=this.Yl:typeof i==typeof this.Yl&&i<=this.Yl;case t.Rh.Jh:return null!=i&&"string"==typeof i&&typeof i==typeof this.Yl&&null!=i.match(this.Yl);case t.Rh.Vh:return null!=i;case t.Rh.qh:return null==i;case t.Rh.Oh:return null!=i&&tg(i)&&tI(i)<this.Yl;case t.Rh.Uh:return null!=i&&tg(i)&&tI(i)>this.Yl;case t.Rh.Kh:return null==i||typeof i!=typeof this.Yl||"string"!=typeof i||null==i.match(this.Yl)}return!1}static fromJson(e){return new t(e.property_key,e.property_type,e.comparator,e.property_value)}ss(){var t=this.Yl;return tg(this.Yl)&&(t=tb(t.valueOf())),{k:this.Xl,t:this.Vl,c:this.comparator,v:t}}static jn(e){return new t(e.k,e.t,e.c,e.v)}}).Rh={Qh:1,Xh:2,Bh:3,Mh:4,kh:5,Lh:6,Jh:10,Vh:11,qh:12,Oh:15,Uh:16,Kh:17},E.yh={Ph:"boolean",Wh:"number",Yh:"string",Zl:"date"},C=class t{constructor(t){this.filters=t}Hl(t){for(var e=!0,i=0;i<this.filters.length;i++){for(var r=this.filters[i],s=!1,n=0;n<r.length;n++)if(r[n].Hl(t)){s=!0;break}if(!s){e=!1;break}}return e}static fromJson(e){if(null==e||!td(e))return null;for(var i=[],r=0;r<e.length;r++){for(var s=[],n=e[r],o=0;o<n.length;o++)s.push(E.fromJson(n[o]));i.push(s)}return new t(i)}ss(){for(var t=[],e=0;e<this.filters.length;e++){for(var i=this.filters[e],r=[],s=0;s<i.length;s++)r.push(i[s].ss());t.push(r)}return t}static jn(e){for(var i=[],r=0;r<e.length;r++){for(var s=[],n=e[r],o=0;o<n.length;o++)s.push(E.jn(n[o]));i.push(s)}return new t(i)}},R=class t{constructor(t,e){this.Jl=t,this.Ql=e}Hl(t){if(null==this.Jl||null==this.Ql)return!1;var e=t[0],i=t[1];return e===this.Jl&&this.Ql.Hl(i)}static fromJson(e){return new t(e?e.event_name:null,e?C.fromJson(e.property_filters):null)}ss(){return{e:this.Jl,pf:this.Ql.ss()}}},x=class t{constructor(t,e){this.fu=t,this.du=e}Hl(t){if(null==this.fu)return!1;var e=q.gu(t[0],this.fu);if(!e)return!1;var i=null==this.du||0===this.du.length;if(null!=this.du){for(var r=0;r<this.du.length;r++)if(this.du[r]===t[1]){i=!0;break}}return e&&i}static fromJson(e){return new t(e?e.id:null,e?e.buttons:null)}ss(){return this.fu}},B=class t{constructor(t){this.productId=t}Hl(t){return null==this.productId||t[0]===this.productId}static fromJson(e){return new t(e?e.product_id:null)}ss(){return this.productId}},P=class t{constructor(t,e){this.productId=t,this.Ql=e}Hl(t){if(null==this.productId||null==this.Ql)return!1;var e=t[0],i=t[1];return e===this.productId&&this.Ql.Hl(i)}static fromJson(e){return new t(e?e.product_id:null,e?C.fromJson(e.property_filters):null)}ss(){return{id:this.productId,pf:this.Ql.ss()}}},$=class t{constructor(t){this.fu=t}Hl(t){return null==this.fu||q.gu(t[0],this.fu)}static fromJson(e){return new t(e?e.campaign_id:null)}ss(){return this.fu}},(q=class t{constructor(t,e){this.type=t,this.data=e}ec(e,i){return t.tc[this.type]===e&&(null==this.data||this.data.Hl(i))}static gu(t,e){var i=null;try{i=window.atob(t)}catch(e){return W.D.info("Failed to unencode analytics id "+t+": "+e.message),!1}return e===i.split("_")[0]}static fromJson(e){var i,r=e.type;switch(r){case t.rc.OPEN:i=null;break;case t.rc.Rr:i=B.fromJson(e.data);break;case t.rc.ac:i=P.fromJson(e.data);break;case t.rc.vr:i=$.fromJson(e.data);break;case t.rc.be:i=k.fromJson(e.data);break;case t.rc.sc:i=R.fromJson(e.data);break;case t.rc.Br:i=x.fromJson(e.data);break;case t.rc.ks:i=null}return new t(r,i)}ss(){return{t:this.type,d:this.data?this.data.ss():null}}static jn(e){var i,r;switch(e.t){case t.rc.OPEN:i=null;break;case t.rc.Rr:i=new B(e.d);break;case t.rc.ac:r=e.d||{},i=new P(r.id,C.jn(r.pf||[]));break;case t.rc.vr:i=new $(e.d);break;case t.rc.be:i=new k(e.d);break;case t.rc.sc:r=e.d||{},i=new R(r.e,C.jn(r.pf||[]));break;case t.rc.Br:i=new x(e.d);break;case t.rc.ks:i=null}return new t(e.t,i)}}).rc={OPEN:"open",Rr:"purchase",ac:"purchase_property",vr:"push_click",be:"custom_event",sc:"custom_event_property",Br:"iam_click",ks:"test"},q.tc={},q.tc[q.rc.OPEN]=t6.OPEN,q.tc[q.rc.Rr]=t6.Rr,q.tc[q.rc.ac]=t6.Rr,q.tc[q.rc.vr]=t6.vr,q.tc[q.rc.be]=t6.be,q.tc[q.rc.sc]=t6.be,q.tc[q.rc.Br]=t6.Br,q.tc[q.rc.ks]=t6.ks,(U=class t{constructor(e,i,r,s,n,o,a,l,u,h,c,d){this.id=e,this.$h=i||[],void 0===r&&(r=null),this.startTime=r,void 0===s&&(s=null),this.endTime=s,this.priority=n||0,this.type=o,this.Zh=l||0,null==h&&(h=1e3*(this.Zh+30)),this.xi=h,this.data=a,null==u&&(u=t.pu),this.Tu=u,this.Du=c,this.Pu=d||null}yu(e){return null==this.Pu||this.Tu!==t.pu&&e-this.Pu>=1e3*this.Tu}ju(t){this.Pu=t}wu(t){return Math.max(t+1e3*this.Zh-new Date().valueOf(),0)}Eu(t){var e=new Date().valueOf()-t,i=null==t||isNaN(e)||null==this.xi||e<this.xi;return i||W.D.info(`Trigger action ${this.type} is no longer eligible for display - fired ${e}ms ago and has a timeout of ${this.xi}ms.`),!i}static fromJson(e){for(var i=e.id,r=[],s=0;s<e.trigger_condition.length;s++)r.push(q.fromJson(e.trigger_condition[s]));var n=ty(e.start_time),o=ty(e.end_time),a=e.priority,l=e.type,u=e.delay,h=e.re_eligibility,c=e.timeout,d=e.data,g=e.min_seconds_since_last_trigger;return tc(t.Fi,l,"Could not construct Trigger from server data","Trigger.Types")?new t(i,r,n,o,a,l,d,u,h,c,g):null}ss(){for(var t=[],e=0;e<this.$h.length;e++)t.push(this.$h[e].ss());return{i:this.id,c:t,s:this.startTime,e:this.endTime,p:this.priority,t:this.type,da:this.data,d:this.Zh,r:this.Tu,tm:this.xi,ss:this.Du,ld:this.Pu}}static jn(e){for(var i=[],r=0;r<e.c.length;r++)i.push(q.jn(e.c[r]));return new t(e.i,i,tS(e.s),tS(e.e),e.p,e.t,e.da,e.d,e.r,e.tm,e.ss,e.ld)}}).pu=-1,U.Fi={Ei:"inapp",Nu:"templated_iam"},L=class{constructor(t,e,i,s){this.vt=t,this.j=e,this.h=i,this.v=s,this.ni=new r,ti.jt(this.ni),this.li=1e3,this.ui=6e4}pi(){return this.ni}mi(t){return this.ni.ut(t)}gi(){return this.ci}fi(t){this.ci=t}di(t,e){return tc(I.Ge,e,`${e} is not a valid in-app message display failure`,"InAppMessage.DisplayFailures")?tr.G(W.A.vi,{trigger_ids:[t],error_code:e}):new m}G(t,e,i,r){var s,n=new m;if(t instanceof _)s={trigger_ids:[t.triggerId]};else{if(e===W.A.yi||t instanceof A&&e===W.A.ji){if(!t.k(r))return W.D.info("This in-app message has already received a click. Ignoring analytics event."),n}else if(e===W.A.bi&&!t.R())return W.D.info("This in-app message has already received an impression. Ignoring analytics event."),n;s=this.Ii(t)}return null==s?n:(null!=i&&(s.bid=i),tr.G(e,s))}Ai(t,e){var i=new m;if(!t.k())return W.D.info("This in-app message button has already received a click. Ignoring analytics event."),i;var r=this.Ii(e);return null==r?i:t.id===D.Mi?(W.D.info("This in-app message button does not have a tracking id. Not logging event to Braze servers."),i):(null!=t.id&&(r.bid=t.id),tr.G(W.A.ji,r))}zi(t){if(t instanceof I){var e,i=t=>{var e=tE(t);return tR(e)?tk(tO.Di,"In-App Message"):function t(e){if(!tL(e))return!1;var i=e[tN.properties.type];return i===tN.types.ue?tC(t,e[tN.properties.me]):i===tN.types.requestPushPermission}(e)&&!K.Ti()?tk(tO._i,"In-App Message"):void 0};for(var r of t.buttons)if(r.clickAction===I.ClickAction.URI&&tB.test(r.uri)&&(e=i(r.uri)))return e;return t.clickAction===I.ClickAction.URI&&tB.test(t.uri)?i(t.uri):void 0}}ki(t,e,i,r){var s=this.vt.wi(!1,!1);(s=this.vt.Ps(s)).template={trigger_id:t.triggerId,trigger_event_type:e},null!=i&&(s.template.data=i.Si());var n=this.vt.Bs(s);this.vt.Gs(s,()=>{Z.Hs({url:`${this.vt.Ks()}/template/`,data:s,headers:n,S:async e=>{if(!this.vt.Os(s,e,n))return this.di(t.triggerId,I.Ge.$i),void("function"==typeof t.Bi&&t.Bi());if(this.vt.Qs(),null==e||null==e.templated_message)return void this.di(t.triggerId,I.Ge.$i);var i=e.templated_message;if(i.type!==U.Fi.Ei)return void this.di(t.triggerId,I.Ge.Gi);var r=t5(i.data);if(null==r)return void this.di(t.triggerId,I.Ge.Gi);var o=this.zi(r);if(o)return W.D.error(o),void("function"==typeof t.Bi&&t.Bi());"function"==typeof t.Ni?t.Ni(r):this.di(t.triggerId,I.Ge.$i)},error:s=>{var n=`getting user personalization for message ${t.triggerId}`;if(new Date().valueOf()-t.qi>t.xi)this.di(t.triggerId,I.Ge.$i);else{var o=Math.min(t.xi,this.ui),a=this.li;null==r&&(r=a);var l=Math.min(o,tz(a,3*r));n+=`. Retrying in ${l} ms`,setTimeout(()=>{this.ki(t,e,i,l)},l)}this.vt.Vs(s,n)}})})}Ii(t){if(null==t.triggerId)return W.D.info("The in-app message has no analytics id. Not logging event to Braze servers."),null;var e={};return null!=t.triggerId&&(e.trigger_ids=[t.triggerId]),e}},tt=t8,te={openUri:ee,so:t7,io:et,yn:ei},j=class t{constructor(t,e,i,r,s){this.triggerId=t,this.Ni=e,this.Bi=i,this.qi=r,this.xi=s}static fromJson(e,i,r,s,n){return null==e||null==e.trigger_id?null:new t(e.trigger_id,i,r,s,n)}},F=class extends g{constructor(t,e,i,r,s){super(),this.tg=t,this.yt=e,this.h=i,this.si=r,this.ig=s,this.sg=[],this.eg=[],this.hg=null,this.og={},this.ng={},this.ag(),this.lg()}gg(){this.hg=this.h.I(tj.q.Na)||this.hg,this.og=this.h.I(tj.q.va)||this.og,this.ng=this.h.I(tj.q.Ga)||this.ng;for(var t=0;t<this.cg.length;t++){var e=this.cg[t];null!=this.ng[e.id]&&e.ju(this.ng[e.id])}}ag(){this.fg=this.h.I(tj.q.Da)||0;for(var t=this.h.I(tj.q.Ya)||[],e=[],i=0;i<t.length;i++)e.push(U.jn(t[i]));this.cg=e,this.gg()}lg(){for(var t=this,e=function(e,i,r,s,n){return function(){t.ug(e,i,r,s,n)}},i={},r=0;r<this.cg.length;r++)i[this.cg[r].id]=this.cg[r];for(var s=!1,n=0;n<this.cg.length;n++){var o=this.cg[n];if(null!=this.og[o.id]){for(var a=this.og[o.id],u=[],h=0;h<a.length;h++){var c=a[h],d=o.wu(c.qi);if(d>0){var g=void 0,f=void 0;u.push(c),null!=c.dg&&(g=c.dg),null!=c.mg&&l.Fa(c.mg)&&(f=l.jn(c.mg));var v=[];if(td(c.pg))for(var p=0;p<c.pg.length;p++){var m=i[c.pg[p]];null!=m&&v.push(m)}this.eg.push(setTimeout(e(o,c.qi,g,f,v),d))}}this.og[o.id].length>u.length&&(this.og[o.id]=u,s=!0,0===this.og[o.id].length&&delete this.og[o.id])}}s&&this.h.B(tj.q.va,this.og)}bg(){for(var t=[],e=0;e<this.cg.length;e++)t.push(this.cg[e].ss());this.fg=new Date().valueOf(),this.h.B(tj.q.Ya,t),this.h.B(tj.q.Da,this.fg)}Tg(){(this.h.I(tj.q.Da)||0)>this.fg?this.ag():this.gg()}Rs(t){var e=!1;if(null!=t&&t.triggers){this.gg();var i={},r={};this.cg=[];for(var s=0;s<t.triggers.length;s++){var n=U.fromJson(t.triggers[s]);null!=this.ng[n.id]&&(n.ju(this.ng[n.id]),i[n.id]=this.ng[n.id]),null!=this.og[n.id]&&(r[n.id]=this.og[n.id]);for(var o=0;o<n.$h.length;o++)if(n.$h[o].ec(t6.ks,null)){e=!0;break}null!=n&&this.cg.push(n)}tm(this.ng,i)||(this.ng=i,this.h.B(tj.q.Ga,this.ng)),tm(this.og,r)||(this.og=r,this.h.B(tj.q.va,this.og)),this.bg(),e&&(W.D.info("Trigger with test condition found, firing test."),this.je(t6.ks)),this.je(t6.OPEN);var a=this.sg;this.sg=[];for(var l=0;l<a.length;l++)this.je.apply(this,a[l])}}async ug(t,e,i,r,s){var n=r=>{this.gg();var s=new Date().valueOf();if(!t.Eu(e))return!1===navigator.onLine&&t.type===U.Fi.Ei&&r.imageUrl?(W.D.info(`Not showing ${t.type} trigger action ${t.id} due to offline state.`),void this.ig.di(t.id,I.Ge.Th)):void(t.yu(s)&&this.yg(t,s,i)?0===this.yt.bu()?W.D.info(`Not displaying trigger ${t.id} because neither automaticallyShowInAppMessages() nor subscribeToInAppMessage() were called.`):(this.yt.St([r]),this.vg(t,s)):W.D.info(`Not displaying trigger ${t.id} because display time fell outside of the acceptable time window.`));t.type===U.Fi.Nu?this.ig.di(t.id,I.Ge.$i):this.ig.di(t.id,I.Ge.ah)},o=()=>{this.gg();var n=s.pop();if(null!=n){if(this.wg(n,e,i,r,s),n.Eu(e)){var a=`Server aborted in-app message display, but the timeout on fallback trigger ${n.id} has already elapsed.`;s.length>0&&(a+=" Continuing to fall back."),W.D.info(a),this.ig.di(n.id,I.Ge.ah),o()}else{W.D.info(`Server aborted in-app message display. Falling back to lower priority ${n.type} trigger action ${t.id}.`);var l=1e3*n.Zh-(new Date().valueOf()-e);l>0?this.eg.push(setTimeout(()=>{this.ug(n,e,i,r,s)},l)):this.ug(n,e,i,r,s)}}};switch(t.type){case U.Fi.Ei:var a=t5(t.data);if(null==a){W.D.error(`Could not parse trigger data for trigger ${t.id}, ignoring.`),this.ig.di(t.id,I.Ge.Gi);break}var l=this.ig.zi(a);if(l){W.D.error(l),o();break}n(a);break;case U.Fi.Nu:var u=j.fromJson(t.data,n,o,e,t.xi);if(null==u){W.D.error(`Could not parse trigger data for trigger ${t.id}, ignoring.`),this.ig.di(t.id,I.Ge.Gi);break}this.ig.ki(u,i,r);break;default:W.D.error(`Trigger ${t.id} was of unexpected type ${t.type}, ignoring.`),this.ig.di(t.id,I.Ge.Gi)}}je(t,e,i){if(tc(t6,t,"Cannot fire trigger action.","TriggerEvents")){if(this.si.Ml())return W.D.info("Trigger sync is currently in progress, awaiting sync completion before firing trigger event."),void this.sg.push(arguments);this.Tg();for(var r=new Date().valueOf(),s=r-this.hg,n=!0,o=!0,a=[],l=0;l<this.cg.length;l++){var u=this.cg[l],h=r+1e3*u.Zh;if(u.yu(h)&&(null==u.startTime||u.startTime<=r)&&(null==u.endTime||u.endTime>=r)){for(var c=!1,d=0;d<u.$h.length;d++)if(u.$h[d].ec(t,e)){c=!0;break}c&&(n=!1,this.yg(u,h,t)&&(o=!1,a.push(u)))}}if(n)return void W.D.info(`Trigger event ${t} did not match any trigger conditions.`);if(o)return void W.D.info(`Ignoring ${t} trigger event because a trigger was displayed ${s/1e3}s ago.`);a.sort((t,e)=>t.priority-e.priority);var g=a.pop();null!=g&&(W.D.info(`Firing ${g.type} trigger action ${g.id} from trigger event ${t}.`),this.wg(g,r,t,i,a),0===g.Zh?this.ug(g,r,t,i,a):this.eg.push(setTimeout(()=>{this.ug(g,r,t,i,a)},1e3*g.Zh)))}}changeUser(t){if(this.cg=[],this.h.Xs(tj.q.Ya),!t){this.sg=[],this.hg=null,this.ng={},this.og={};for(var e=0;e<this.eg.length;e++)clearTimeout(this.eg[e]);this.eg=[],this.h.Xs(tj.q.Na),this.h.Xs(tj.q.Ga),this.h.Xs(tj.q.va)}}clearData(){this.cg=[],this.hg=null,this.ng={},this.og={};for(var t=0;t<this.eg.length;t++)clearTimeout(this.eg[t]);this.eg=[]}yg(t,e,i){if(null==this.hg)return!0;if(i===t6.ks)return W.D.info("Ignoring minimum interval between trigger because it is a test type."),!0;var r=t.Du;return null==r&&(r=this.tg),e-this.hg>=1e3*r}wg(t,e,i,r,s){this.gg(),this.og[t.id]=this.og[t.id]||[];var n,o={};o.qi=e,o.dg=i,null!=r&&(n=r.ss()),o.mg=n;for(var a=[],l=0;l<s.length;l++)a.push(s[l].id);o.pg=a,this.og[t.id].push(o),this.h.B(tj.q.va,this.og)}vg(t,e){this.gg(),t.ju(e),this.hg=e,this.h.B(tj.q.Na,e),this.ng[t.id]=e,this.h.B(tj.q.Ga,this.ng)}},M=class t{constructor(t,e,i,r,s){this.endpoint=t||null,this._n=e||null,this.publicKey=i||null,this.zl=r||null,this.gl=s||null}ss(){return{e:this.endpoint,c:this._n,p:this.publicKey,u:this.zl,v:this.gl}}static jn(e){return new t(e.e,tS(e.c),e.p,e.u,e.v)}},G=class{constructor(t,e){this.gt=t,this.h=e}getUserId(){var t=this.h.tu(tj.eu.su);if(null==t)return null;var e=t.iu,i=tT(e);if(i>h.ee){for(;i>h.ee;)i=tT(e=e.slice(0,e.length-1));t.iu=e,this.h.ru(tj.eu.su,t)}return e}uu(t){var e=null==this.getUserId();this.h.ru(tj.eu.su,new u(t)),e&&this.h.ou(t)}setCustomUserAttribute(t,e){if(this.gt.hu(t))return W.D.info('Custom Attribute "'+t+'" is blocklisted, ignoring.'),!1;var i={};return i[t]=e,this.nu(h.lu,i,!0)}nu(t,e,i,r){var s=this.h.mu(this.getUserId(),t,e),n="",o=t,a=e;return i&&(n=" custom","object"==typeof e&&(o=Object.keys(e)[0],a=e[o])),!r&&s&&W.D.info(`Logged${n} attribute ${o} with value ${a}`),s}Zr(t,e,i,r,s){this.nu("push_token",t,!1,!0),this.nu("custom_push_public_key",i,!1,!0),this.nu("custom_push_user_auth",r,!1,!0),this.nu("custom_push_vapid_public_key",s,!1,!0);var n=W.xt.Ft,o=new W.qt(n,W.D),a=new M(t,e,i,r,s);this.h.B(tj.q.Sn,a.ss()),o.setItem(n.$t.cu,n.se,!0)}fn(t){if(this.nu("push_token",null,!1,!0),this.nu("custom_push_public_key",null,!1,!0),this.nu("custom_push_user_auth",null,!1,!0),this.nu("custom_push_vapid_public_key",null,!1,!0),t){var e=W.xt.Ft,i=new W.qt(e,W.D);this.h.B(tj.q.Sn,!1),i.setItem(e.$t.cu,e.se,!1)}}},ti=new class t{constructor(){this.Lo=!1,this.Po=!1,this.Ro=new r,this.Mo=new r,this.jo={},this.yo=[],this.Do=[],this.ni=[],this.Uo="4.6.3"}zo(t){this.Ro.ut(t)}rh(t){this.Mo.ut(t)}initialize(i,s){if(this.Bo())return W.D.info("Braze has already been initialized with an API key."),!0;this.jo=s||{};var n=this.nn(eo.Io),o=er(te.yn());if(o&&"true"===o.brazeLogging&&(n=!0),W.D.init(n),W.D.info(`Initialization Options: ${JSON.stringify(this.jo,null,2)}`),null==i||""===i||"string"!=typeof i)return W.D.error("Braze requires a valid API key to be initialized."),!1;this._r=i;var a=this.nn(eo.po);if(null==a||""===a||"string"!=typeof a)return W.D.error("Braze requires a valid baseUrl to be initialized."),!1;!1===/^https?:/.test(a)&&(a=`https://${a}`);var l=a;if((a=document.createElement("a")).href=l,"/"===a.pathname&&(a=`${a}api/v3`),this.Wo=a.toString(),Y.Fo&&!this.nn(eo.ho))return W.D.info("Ignoring activity from crawler bot "+navigator.userAgent),this.Po=!0,!1;var u=this.nn(t.Eo)||!1;if(this.h=X.Vo(i,u),new c.ne(null,!0).lr(tj.ae))return W.D.info("Ignoring all activity due to previous opt out"),this.Po=!0,!1;for(var h of tp(this.jo))-1===th(W.Go).indexOf(h)&&W.D.warn(`Ignoring unknown initialization option '${h}'.`);if(null!=this.nn(eo.Co)){var g=this.nn(eo.Co);-1!==["mparticle","wordpress","tealium"].indexOf(g)?this.Ko=g:W.D.error("Invalid sdk flavor passed: "+g)}var f=this.nn(W.Go._o);if(null!=f){if(td(f)){for(var m=[],y=0;y<f.length;y++)tc(tF,f[y],"devicePropertyAllowlist contained an invalid value.","DeviceProperties")&&m.push(f[y]);f=m}else W.D.error("devicePropertyAllowlist must be an array. Defaulting to all properties."),f=null}this.Ur=new v(this.h,f),this.gt=new w(this.h),this.v=new G(this.gt,this.h),this.j=new S(this.h,this.v,this.gt,this.nn(eo.No));var _=new r;return this.Ho=new d(this.h,this.nn(eo.Ao),_),this.jt(_),this.vt=new p(this.Ur,this.h,this.Ho,this.v,this.j,this.gt,this._r,this.Wo,this.Uo,this.Ko,this.nn(eo.wo)),this.si=new b(this._r,this.Wo,this.j,this.Ur,this.v,this.gt,this.h,t=>{if(this.Bo())for(var e of this.re())e.Rs(t)},this.Ho,this.vt),this.si.initialize(),W.D.info(`Initialized for the Braze backend at "${this.nn(eo.po)}" with API key "${this._r}".`),null!=this.nn(eo.To)&&tM("enableHtmlInAppMessages","initialization option","allowUserSuppliedJavascript"),en.init(),this.gt.qe(()=>{this.Lo&&this.gt._e()&&e("bx3m11").then(function(t){return t.a}).then(t=>{this.Lo&&(0,t.default)()})}),this.si.cr(()=>{this.Lo&&this.gt._e()&&e("bx3m11").then(function(t){return t.a}).then(t=>{this.Lo&&(0,t.default)(null,null,!0)})}),this.Ro.St(this.jo),this.Lo=!0,!0}destroy(t){if(W.D.destroy(),this.Bo()){for(var e of(this.Mo.St(),this.Mo.removeAllSubscriptions(),this.yo))e.destroy();for(var i of(this.yo=[],this.Do))i.clearData(!1);this.Do=[],this.removeAllSubscriptions(),this.ni=[],this.si.destroy(),this.si=null,this.Ho=null,this.Ur=null,this.vt=null,this.gt=null,this.j=null,this.v=null,this.jo={},this.Ko=void 0,this.Lo=!1,this.Po=!1,t&&(this.h=null)}}rr(){if(this.$o())return!1;if(!this.Bo())throw Error("Braze must be initialized before calling methods.");return!0}ea(){return this._r}ii(){return this.Ho}Ks(){return this.Wo}ce(){return this.Ur}nr(){return this.vt}nn(t){return this.jo[t]}re(){return this.Do}mr(){return this.si}ir(){return this.gt}g(){return this.j}l(){return this.h}gr(){if(this.v&&this.si)return new h(this.v,this.si)}p(){return this.v}tr(){return!0===this.nn(eo.Oo)||!0===this.nn(eo.To)}u(t){var e=!1;for(var i of this.yo)i===t&&(e=!0);e||this.yo.push(t)}ar(t){var e=!1;for(var i of this.Do)i.constructor===t.constructor&&(e=!0);t instanceof g&&!e&&this.Do.push(t)}jt(t){t instanceof r&&this.ni.push(t)}removeAllSubscriptions(){if(this.rr())for(var t of this.ni)t.removeAllSubscriptions()}removeSubscription(t){if(this.rr())for(var e of this.ni)e.removeSubscription(t)}le(t){this.Po=t}Bo(){return this.Lo}$o(){return this.Po}Ds(){return this.Uo}},tr=ea,t({$:tv,A:Z,B:tB,C:_,D:tZ,E:tR,F:T,G:tk,H:A,I:I,J:tO,K:t4,L:tQ,M:N,N:t0,O:tD,P:tM,Q:tc,R:tT,S:O,T:eo,U:h,V:t6,W:te,X:t$,Y:c,Z:tq,_:tU,a:tX,a0:K,a1:tF,a2:tz,a3:M,a4:tm,b:t2,c:tb,d:ty,e:ti,f:en,g:tE,h:tN,i:tL,j:er,k:tp,l:D,m:t3,n:t9,o:Y,p:tt,q:es,r:W,s:tj,t:m,u:r,v:tr,w:td,x:tS,y:g,z:tH})},[]]},[]]);
