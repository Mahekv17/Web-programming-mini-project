(this.$WP=this.$WP||[]).push(["bx3m11",(e,t)=>{function r(e){if(e[l.At.ns]&&"boolean"==typeof e[l.At.Fe])return new l(e[l.At.ns],e[l.At.Fe],e[l.At.we]);s.D.info(`Unable to create feature flag from ${JSON.stringify(e,null,2)}`)}var s,i,n,h,o,u,a,l,f,p,v={t:!1,provider:null,er:()=>(v.o(),v.provider||(v.provider=new f(h.ir(),h.nr(),h.l()),h.ar(v.provider)),v.provider),o:()=>{v.t||(h.u(v),v.t=!0)},destroy:()=>{v.provider=null,v.t=!1}};function g(e,t,r){if(h.rr())return p.er().refreshFeatureFlags(e,t,r)}function d(e,t){g(e,t)}return e({n:r,r:d}),[()=>{(l=class e{constructor(e,t=!1,r={}){this.id=e,this.enabled=t,this.properties=r}getStringProperty(e){if(!this.yr(e))return null;var t=this.properties[e];return this.Er(t,"string")?t.value:null}getNumberProperty(e){if(!this.yr(e))return null;var t=this.properties[e];return this.Er(t,"number")?t.value:null}getBooleanProperty(e){if(!this.yr(e))return null;var t=this.properties[e];return this.Er(t,"boolean")?t.value:null}ss(){var t={};return t[e.hs.ns]=this.id,t[e.hs.Fe]=this.enabled,t[e.hs.we]=this.properties,t}yr(e){return!(!this.properties||!this.properties[e])||(s.D.info(`${e} not found in feature flag properties.`),!1)}Er(e,t){return e.type===t&&typeof e.value===t||(s.D.info(`Property is not of type ${t}.`),!1)}}).hs={ns:"id",Fe:"e",we:"pr"},l.At={ns:"id",Fe:"enabled",we:"properties"},f=class extends i{constructor(e,t,r){super(),this.gt=e,this.vt=t,this.h=r,this.he=new n,this.ye=10,this.Te=null,h.jt(this.he)}Rs(e){if(this.gt._e()&&null!=e&&e.feature_flags){for(var t of(this.Re=[],e.feature_flags)){var s=r(t);s&&this.Re.push(s)}this.De=new Date().getTime(),this.Ne(),this.he.St(this.Re)}}xe(){var e=this.h.I(o.q.ze)||{},t={};for(var r in e){var i=function(e){if(e[l.hs.ns]&&"boolean"==typeof e[l.hs.Fe])return new l(e[l.hs.ns],e[l.hs.Fe],e[l.hs.we]);s.D.info(`Unable to deserialize feature flag from ${JSON.stringify(e,null,2)}`)}(e[r]);i&&(t[i.id]=i)}return t}Ws(e){return this.he.ut(e)}refreshFeatureFlags(e,t,r,s){if(!this.Se(r))return this.$e||(this.$e=this.gt.qe(()=>{this.refreshFeatureFlags(e,t)})),void("function"==typeof t&&t());null==s&&(s=!0),s&&this.Me();var i=this.vt.Ps({},!0),n=this.vt.Bs(i,!1,!0),h=!1;this.vt.Gs(i,()=>{u.Hs({url:`${this.vt.Ks()}/feature_flags/sync`,headers:n,data:i,S:r=>{if(!this.vt.Os(i,r,n))return h=!0,void("function"==typeof t&&t());this.vt.Qs(),this.Rs(r),"function"==typeof e&&e()},error:e=>{this.vt.Vs(e,"retrieving feature flags"),h=!0,"function"==typeof t&&t()},Ue:()=>{if(s&&h&&!this.ke){var i=this.Te;(null==i||i<1e3*this.ye)&&(i=1e3*this.ye),this.Ae(Math.min(3e5,a(1e3*this.ye,3*i)),e,t,r)}}})})}Me(){null!=this.ke&&(clearTimeout(this.ke),this.ke=null)}Ae(e,t,r,s){null==e&&(e=1e3*this.ye),this.Me(),this.ke=setTimeout(()=>{this.refreshFeatureFlags(t,r,s)},e),this.Te=e}Se(e){if(!e){var t=parseFloat(this.gt.Be()),r=!1;if(!isNaN(t)){if(-1===t)return s.D.info("Feature flag refreshes not allowed"),!1;r=new Date().getTime()>=(this.De||0)+1e3*t}if(!r)return s.D.info(`Feature flag refreshes were rate limited to ${t} seconds`),!1}return this.gt._e()}Ne(){for(var e={},t=0;t<this.Re.length;t++){var r=this.Re[t],s=r.ss();e[r.id]=s}this.h.B(o.q.ze,e),this.h.B(o.q.Ce,this.De)}},p=v,e({F:l,a:Object.freeze({__proto__:null,refreshFeatureFlags:d,default:g}),i:p,n:r,r:d})},[e=>(s=e.r,i=e.y,n=e.u,h=e.e,o=e.s,u=e.A,a=e.a2)]]},["okmmp9"]]);
